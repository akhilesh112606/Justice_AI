<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReviewerAI - Analysis Results</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; min-height: 100%; font-family: 'Space Grotesk', 'Sora', system-ui, -apple-system, sans-serif; }
    body { 
      background: radial-gradient(circle at 20% 20%, #121212, #090909 35%, #050505 70%, #000); 
      color: #ffffff; 
      overflow-x: hidden; 
      position: relative; 
    }
    body::after { 
      content: ''; 
      position: fixed; 
      inset: 0; 
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.06'/%3E%3C/svg%3E"); 
      pointer-events: none; 
      z-index: 1; 
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }

    @keyframes fadeInUp { 
      from { opacity: 0; transform: translateY(40px); } 
      to { opacity: 1; transform: translateY(0); } 
    }

    @keyframes pulse { 
      0%, 100% { opacity: 0.6; } 
      50% { opacity: 1; } 
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    @keyframes scanLine {
      0% { top: 0; opacity: 1; }
      100% { top: 100%; opacity: 0.3; }
    }

    @keyframes highlightPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(138, 243, 255, 0.5), inset 0 0 10px rgba(138, 243, 255, 0.1); }
      50% { box-shadow: 0 0 25px rgba(138, 243, 255, 0.8), inset 0 0 20px rgba(138, 243, 255, 0.2); }
    }

    /* Background */
    .background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; }
    .bg-orb { position: absolute; border-radius: 50%; filter: blur(80px); }
    .orb-1 { width: 420px; height: 420px; background: radial-gradient(circle, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.04)); top: -40px; left: 8%; animation: blob 8s ease-in-out infinite; }
    .orb-2 { width: 420px; height: 420px; background: radial-gradient(circle, rgba(255, 255, 255, 0.14), rgba(0, 0, 0, 0)); bottom: 5%; right: 4%; animation: blob-2 10s ease-in-out infinite; }
    .orb-3 { width: 360px; height: 360px; background: radial-gradient(circle, rgba(255, 255, 255, 0.22), rgba(0, 0, 0, 0)); top: 50%; left: 50%; transform: translate(-50%, -50%); animation: blob-3 12s ease-in-out infinite; }
    
    @keyframes blob { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(20px, -30px) scale(1.1); } 50% { transform: translate(-20px, 20px) scale(0.95); } 75% { transform: translate(30px, 10px) scale(1.05); } }
    @keyframes blob-2 { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(-30px, 20px) scale(0.95); } 50% { transform: translate(25px, -15px) scale(1.1); } 75% { transform: translate(-15px, -25px) scale(0.98); } }
    @keyframes blob-3 { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 25% { transform: translate(calc(-50% + 15px), calc(-50% - 20px)) scale(1.08); } 50% { transform: translate(calc(-50% - 20px), calc(-50% + 15px)) scale(0.92); } 75% { transform: translate(calc(-50% + 25px), calc(-50% + 20px)) scale(1.05); } }

    .grid-overlay { 
      position: absolute; 
      inset: 0; 
      background-image: linear-gradient(to right, rgba(255, 255, 255, 0.04) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.04) 1px, transparent 1px); 
      background-size: 4rem 4rem; 
      mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, #000 70%, transparent 100%); 
    }
    .vignette { position: absolute; inset: -8%; pointer-events: none; background: radial-gradient(circle at center, transparent 52%, rgba(0, 0, 0, 0.35) 75%, rgba(0, 0, 0, 0.55) 100%); mix-blend-mode: multiply; opacity: 0.6; }

    /* Corner badge */
    .corner-badge { position: fixed; bottom: 16px; right: 16px; z-index: 9999; display: flex; align-items: center; gap: 8px; padding: 12px 18px; background: linear-gradient(135deg, rgba(12,14,18,0.96), rgba(6,8,12,0.98)); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; box-shadow: 0 10px 32px rgba(0,0,0,0.6); backdrop-filter: blur(12px); pointer-events: none; }
    .corner-badge-dot { width: 8px; height: 8px; border-radius: 50%; background: linear-gradient(135deg, #8af3ff, #5ed2ff); box-shadow: 0 0 10px rgba(138,243,255,0.8); animation: badgePulse 2s ease-in-out infinite; }
    .corner-badge-text { font-size: 12px; font-weight: 700; letter-spacing: 1.5px; color: rgba(255,255,255,0.85); text-transform: uppercase; }
    @keyframes badgePulse { 0%, 100% { opacity: 0.6; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } }

    /* Content */
    .content { position: relative; z-index: 10; padding: 40px 0 80px; }

    /* Header */
    .header { text-align: center; margin-bottom: 32px; animation: fadeInUp 0.8s ease-out forwards; }
    .header-title { font-size: clamp(28px, 4vw, 42px); font-weight: 700; margin-bottom: 8px; background: linear-gradient(120deg, #ffffff 0%, #ffffff 50%, #ffffff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header-subtitle { font-size: 14px; color: #ffffff; letter-spacing: 4px; text-transform: uppercase; }

    /* File info card */
    .file-info { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 24px; animation: fadeInUp 0.8s ease-out 0.1s forwards; opacity: 0; }
    .info-chip { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 12px; backdrop-filter: blur(10px); }
    .info-chip svg { width: 16px; height: 16px; color: #8af3ff; }
    .info-chip-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }
    .info-chip-value { font-size: 13px; font-weight: 600; color: #ffffff; }

    /* Score chip */
    .score-chip { background: linear-gradient(135deg, rgba(138, 243, 255, 0.1), rgba(94, 210, 255, 0.05)); border-color: rgba(138, 243, 255, 0.3); }
    .score-chip .info-chip-value { color: #8af3ff; font-size: 16px; }

    /* Main layout - Two columns */
    .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; animation: fadeInUp 0.8s ease-out 0.2s forwards; opacity: 0; }

    @media (max-width: 1024px) {
      .main-layout { grid-template-columns: 1fr; }
    }

    /* PDF Viewer Card */
    .pdf-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }
    .pdf-card-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .pdf-card-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .pdf-card-title svg { width: 20px; height: 20px; color: #8af3ff; }

    /* PDF Navigation */
    .pdf-nav { display: flex; align-items: center; gap: 12px; }
    .pdf-nav-btn { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.06); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; color: #ffffff; }
    .pdf-nav-btn:hover:not(:disabled) { background: rgba(138, 243, 255, 0.15); border-color: rgba(138, 243, 255, 0.4); }
    .pdf-nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .pdf-nav-btn svg { width: 16px; height: 16px; }
    .pdf-page-info { font-size: 13px; color: #9ca3af; min-width: 80px; text-align: center; }
    .pdf-page-info span { color: #8af3ff; font-weight: 600; }

    /* PDF Container */
    .pdf-container { position: relative; flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; background: rgba(0, 0, 0, 0.2); min-height: 60vh; overflow: hidden; }
    .pdf-wrapper { position: relative; display: inline-block; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); border-radius: 4px; overflow: hidden; }
    #pdf-canvas { display: block; max-width: 100%; height: auto; }

    /* Highlight Overlay */
    .highlight-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    .highlight-box { position: absolute; background: rgba(138, 243, 255, 0.2); border: 2px solid rgba(138, 243, 255, 0.6); border-radius: 4px; opacity: 0; transition: all 0.4s ease; }
    .highlight-box.active { opacity: 1; animation: highlightPulse 1.5s ease-in-out infinite; }

    /* Scan Line Effect */
    .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, transparent, rgba(138, 243, 255, 0.8), transparent); pointer-events: none; opacity: 0; z-index: 11; }
    .scan-line.active { animation: scanLine 1.5s ease-in-out; }

    /* Connection Line */
    .connection-line { position: fixed; pointer-events: none; z-index: 100; opacity: 0; transition: opacity 0.3s ease; }
    .connection-line.active { opacity: 1; }
    .connection-line svg { overflow: visible; }
    .connection-line path { stroke: #8af3ff; stroke-width: 2; fill: none; stroke-dasharray: 8 4; animation: dashMove 0.5s linear infinite; }
    @keyframes dashMove { to { stroke-dashoffset: -12; } }

    /* Text fallback card */
    .text-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }
    .text-card-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .text-card-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .text-card-title svg { width: 20px; height: 20px; color: #8af3ff; }
    .text-card-actions { display: flex; gap: 6px; }
    
    .text-content { padding: 20px; max-height: 55vh; overflow-y: auto; flex: 1; }
    .text-content pre { white-space: pre-wrap; word-wrap: break-word; font-family: 'Space Grotesk', monospace; font-size: 14px; line-height: 1.7; color: #e5e7eb; }

    /* Highlighted text */
    .text-content pre .highlight { background: rgba(138, 243, 255, 0.2); border-radius: 3px; padding: 2px 4px; transition: all 0.3s ease; }
    .text-content pre .highlight.active { background: rgba(138, 243, 255, 0.4); box-shadow: 0 0 20px rgba(138, 243, 255, 0.3); }

    /* Suggestions Panel */
    .suggestions-panel { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }

    .suggestions-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .suggestions-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .suggestions-title svg { width: 20px; height: 20px; color: #8af3ff; }

    /* Page tabs */
    .page-tabs { display: flex; gap: 8px; padding: 12px 16px; border-bottom: 1px solid rgba(255, 255, 255, 0.06); overflow-x: auto; flex-shrink: 0; }
    .page-tabs::-webkit-scrollbar { height: 4px; }
    .page-tabs::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .page-tabs::-webkit-scrollbar-thumb { background: rgba(138, 243, 255, 0.3); border-radius: 2px; }

    .page-tab { padding: 8px 16px; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 13px; font-weight: 500; color: #9ca3af; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; }
    .page-tab:hover { background: rgba(255, 255, 255, 0.08); color: #ffffff; border-color: rgba(255, 255, 255, 0.2); }
    .page-tab.active { background: linear-gradient(135deg, rgba(138, 243, 255, 0.15), rgba(94, 210, 255, 0.1)); border-color: rgba(138, 243, 255, 0.4); color: #8af3ff; }
    .page-tab .score-badge { display: inline-block; margin-left: 8px; padding: 2px 6px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; font-size: 11px; }

    /* Suggestions content */
    .suggestions-content { padding: 16px; max-height: 55vh; overflow-y: auto; flex: 1; }

    /* Overall summary */
    .overall-summary { margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(138, 243, 255, 0.06), rgba(94, 210, 255, 0.03)); border: 1px solid rgba(138, 243, 255, 0.15); border-radius: 14px; }
    .summary-grade { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; }
    .grade-circle { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; background: linear-gradient(135deg, #8af3ff, #5ed2ff); color: #050505; box-shadow: 0 8px 24px rgba(138, 243, 255, 0.3); }
    .grade-info h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .grade-info p { font-size: 13px; color: #9ca3af; }

    .summary-lists { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .summary-list { padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
    .summary-list h5 { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8af3ff; margin-bottom: 8px; }
    .summary-list ul { list-style: none; font-size: 12px; color: #d1d5db; }
    .summary-list li { padding: 4px 0; padding-left: 16px; position: relative; }
    .summary-list li::before { content: 'â†’'; position: absolute; left: 0; color: #8af3ff; }

    /* Page suggestions */
    .page-suggestions { display: none; }
    .page-suggestions.active { display: block; }

    .page-summary { font-size: 13px; color: #9ca3af; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.06); }

    /* Suggestion card */
    .suggestion-card { padding: 14px; margin-bottom: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
    .suggestion-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: #8af3ff; opacity: 0; transition: opacity 0.3s ease; }
    .suggestion-card:hover { background: rgba(255, 255, 255, 0.06); border-color: rgba(138, 243, 255, 0.3); transform: translateX(4px); }
    .suggestion-card:hover::before { opacity: 1; }
    .suggestion-card.expanded { background: rgba(138, 243, 255, 0.08); border-color: rgba(138, 243, 255, 0.4); }
    .suggestion-card.expanded::before { opacity: 1; }

    .suggestion-header { display: flex; align-items: flex-start; gap: 12px; }

    .severity-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .severity-icon svg { width: 18px; height: 18px; }
    .severity-critical { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .severity-major { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .severity-minor { background: rgba(138, 243, 255, 0.2); color: #8af3ff; }
    .severity-info { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }

    .suggestion-main { flex: 1; min-width: 0; }
    .suggestion-type { display: inline-block; padding: 3px 8px; background: rgba(255, 255, 255, 0.08); border-radius: 6px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #9ca3af; margin-bottom: 6px; }
    .suggestion-title { font-size: 14px; font-weight: 600; color: #ffffff; margin-bottom: 4px; }
    .suggestion-location { font-size: 12px; color: #6b7280; }

    .suggestion-expand { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 6px; background: rgba(255, 255, 255, 0.05); transition: all 0.3s ease; flex-shrink: 0; }
    .suggestion-expand svg { width: 14px; height: 14px; color: #9ca3af; transition: transform 0.3s ease; }
    .suggestion-card.expanded .suggestion-expand svg { transform: rotate(180deg); }

    .suggestion-details { display: none; margin-top: 14px; padding-top: 14px; border-top: 1px solid rgba(255, 255, 255, 0.06); }
    .suggestion-card.expanded .suggestion-details { display: block; }

    .detail-row { margin-bottom: 12px; }
    .detail-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #6b7280; margin-bottom: 4px; }
    .detail-value { font-size: 13px; color: #d1d5db; line-height: 1.5; }
    .detail-value.affected-text { padding: 8px 12px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-family: monospace; font-size: 12px; word-break: break-all; }

    /* Buttons */
    .btn { cursor: pointer; border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; font-size: 14px; transition: all 0.4s ease; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
    .btn-primary { 
      background: linear-gradient(135deg, #ffffff, #b5b5b5 50%, #ffffff); 
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #050505; 
      box-shadow: 0 18px 50px rgba(255, 255, 255, 0.12); 
    }
    .btn-primary:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 22px 60px rgba(255, 255, 255, 0.18); }
    .btn-secondary { 
      background: rgba(255, 255, 255, 0.04); 
      border: 1px solid rgba(255, 255, 255, 0.18); 
      color: #f5f5f5; 
      backdrop-filter: blur(12px);
    }
    .btn-secondary:hover { transform: translateY(-2px) scale(1.02); border-color: rgba(255, 255, 255, 0.35); box-shadow: 0 16px 40px rgba(255, 255, 255, 0.12); }
    .btn-icon { padding: 10px; border-radius: 10px; }

    /* Actions */
    .actions { display: flex; gap: 16px; justify-content: center; margin-top: 32px; animation: fadeInUp 0.8s ease-out 0.3s forwards; opacity: 0; }

    /* Scrollbar */
    .text-content::-webkit-scrollbar, .suggestions-content::-webkit-scrollbar { width: 6px; }
    .text-content::-webkit-scrollbar-track, .suggestions-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 3px; }
    .text-content::-webkit-scrollbar-thumb, .suggestions-content::-webkit-scrollbar-thumb { background: rgba(138, 243, 255, 0.3); border-radius: 3px; }
    .text-content::-webkit-scrollbar-thumb:hover, .suggestions-content::-webkit-scrollbar-thumb:hover { background: rgba(138, 243, 255, 0.5); }

    /* SVG Icons */
    svg { fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* Loading state */
    .loading-shimmer { background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }

    .pdf-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; color: #9ca3af; }
    .pdf-loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(138, 243, 255, 0.2); border-top-color: #8af3ff; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Empty state */
    .empty-state { text-align: center; padding: 40px 20px; color: #6b7280; }
    .empty-state svg { width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state h4 { font-size: 16px; color: #9ca3af; margin-bottom: 8px; }
    .empty-state p { font-size: 13px; }

    /* Tooltip */
    .tooltip { position: fixed; z-index: 9999; padding: 10px 14px; background: rgba(20, 20, 25, 0.98); border: 1px solid rgba(138, 243, 255, 0.3); border-radius: 10px; font-size: 13px; color: #ffffff; max-width: 300px; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6); pointer-events: none; opacity: 0; transform: translateY(8px); transition: all 0.2s ease; }
    .tooltip.visible { opacity: 1; transform: translateY(0); }
    .tooltip-title { font-weight: 600; margin-bottom: 6px; color: #8af3ff; }
    .tooltip-fix { font-size: 12px; color: #9ca3af; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }

    /* Responsive */
    @media (max-width: 640px) {
      .pdf-card-header, .text-card-header, .suggestions-header { flex-direction: column; gap: 12px; align-items: flex-start; }
      .actions { flex-direction: column; }
      .actions .btn { width: 100%; justify-content: center; }
      .summary-lists { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>
    <div class="grid-overlay"></div>
    <div class="vignette"></div>
  </div>

  <div class="corner-badge">
    <div class="corner-badge-dot"></div>
    <span class="corner-badge-text">ReviewerAI</span>
  </div>

  <!-- Tooltip container -->
  <div id="tooltip" class="tooltip">
    <div class="tooltip-title"></div>
    <div class="tooltip-desc"></div>
    <div class="tooltip-fix"></div>
  </div>

  <!-- Connection line for mapping animation -->
  <div id="connection-line" class="connection-line">
    <svg width="100%" height="100%">
      <path id="connection-path" d="" />
    </svg>
  </div>

  <div class="content">
    <div class="container">
      <div class="header">
        <h1 class="header-title">Analysis Results</h1>
        <p class="header-subtitle">Research Paper Review</p>
      </div>

      <div class="file-info">
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
          <div>
            <div class="info-chip-label">File</div>
            <div class="info-chip-value">{{ filename }}</div>
          </div>
        </div>
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M4 7V4h16v3"></path><path d="M9 20h6"></path><path d="M12 4v16"></path></svg>
          <div>
            <div class="info-chip-label">Words</div>
            <div class="info-chip-value">{{ word_count | default(0) }}</div>
          </div>
        </div>
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
          <div>
            <div class="info-chip-label">Characters</div>
            <div class="info-chip-value">{{ char_count | default(0) }}</div>
          </div>
        </div>
        {% if formatting_data and formatting_data.score %}
        <div class="info-chip score-chip">
          <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
          <div>
            <div class="info-chip-label">Format Score</div>
            <div class="info-chip-value">{{ formatting_data.score }}/100</div>
          </div>
        </div>
        {% endif %}
      </div>

      <div class="main-layout">
        <!-- PDF Viewer Column -->
        {% if is_pdf and pdf_base64 %}
        <div class="pdf-card" id="pdf-card">
          <div class="pdf-card-header">
            <div class="pdf-card-title">
              <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
              Document Preview
            </div>
            <div class="pdf-nav">
              <button class="pdf-nav-btn" id="prev-page" disabled title="Previous Page">
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
              </button>
              <div class="pdf-page-info">
                Page <span id="current-page">1</span> of <span id="total-pages">-</span>
              </div>
              <button class="pdf-nav-btn" id="next-page" title="Next Page">
                <svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
              </button>
            </div>
          </div>
          <div class="pdf-container" id="pdf-container">
            <div class="pdf-loading" id="pdf-loading">
              <div class="pdf-loading-spinner"></div>
              <span>Loading PDF...</span>
            </div>
            <div class="pdf-wrapper" id="pdf-wrapper" style="display: none;">
              <canvas id="pdf-canvas"></canvas>
              <div class="highlight-overlay" id="highlight-overlay"></div>
              <div class="scan-line" id="scan-line"></div>
            </div>
          </div>
        </div>
        {% else %}
        <!-- Text fallback for non-PDF files -->
        <div class="text-card">
          <div class="text-card-header">
            <div class="text-card-title">
              <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
              Extracted Text
            </div>
            <div class="text-card-actions">
              <button class="btn btn-secondary btn-icon" onclick="copyText()" title="Copy to clipboard">
                <svg viewBox="0 0 24 24" style="width: 16px; height: 16px;"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
              <button class="btn btn-secondary btn-icon" onclick="downloadText()" title="Download text">
                <svg viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              </button>
            </div>
          </div>
          <div class="text-content">
            <pre id="extracted-text">{{ extracted_text }}</pre>
          </div>
        </div>
        {% endif %}

        <!-- Formatting Suggestions Column -->
        <div class="suggestions-panel" id="suggestions-panel">
          <div class="suggestions-header">
            <div class="suggestions-title">
              <svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
              Formatting Suggestions
            </div>
          </div>

          {% if formatting_data and formatting_data.pages %}
          <!-- Page tabs -->
          <div class="page-tabs" id="page-tabs">
            <button class="page-tab active" data-page="overall">
              Overview
            </button>
            {% for page in formatting_data.pages %}
            <button class="page-tab" data-page="{{ page.page_number }}">
              Page {{ page.page_number }}
              <span class="score-badge">{{ page.page_score }}</span>
            </button>
            {% endfor %}
          </div>

          <div class="suggestions-content">
            <!-- Overall Summary -->
            <div class="page-suggestions active" data-page="overall">
              {% if formatting_data.overall %}
              <div class="overall-summary">
                <div class="summary-grade">
                  <div class="grade-circle">{{ formatting_data.overall.grade | default('B') }}</div>
                  <div class="grade-info">
                    <h4>Document Quality Score: {{ formatting_data.score }}/100</h4>
                    <p>{{ formatting_data.total_pages }} page(s) analyzed</p>
                  </div>
                </div>
                <div class="summary-lists">
                  {% if formatting_data.overall.strengths %}
                  <div class="summary-list">
                    <h5>Strengths</h5>
                    <ul>
                      {% for strength in formatting_data.overall.strengths[:3] %}
                      <li>{{ strength }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                  {% if formatting_data.overall.improvements_needed %}
                  <div class="summary-list">
                    <h5>Needs Improvement</h5>
                    <ul>
                      {% for improvement in formatting_data.overall.improvements_needed[:3] %}
                      <li>{{ improvement }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endif %}

              {% if formatting_data.overall and formatting_data.overall.suggestions %}
              {% for suggestion in formatting_data.overall.suggestions %}
              <div class="suggestion-card" 
                   data-title="{{ suggestion.title }}"
                   data-description="{{ suggestion.description | default('') }}"
                   data-fix=""
                   data-page="0">
                <div class="suggestion-header">
                  <div class="severity-icon severity-{{ suggestion.priority | default('medium') | replace('high', 'major') | replace('medium', 'minor') | replace('low', 'info') }}">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path></svg>
                  </div>
                  <div class="suggestion-main">
                    <span class="suggestion-type">{{ suggestion.type | default('structure') }}</span>
                    <div class="suggestion-title">{{ suggestion.title }}</div>
                  </div>
                  <div class="suggestion-expand">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>
                  </div>
                </div>
                <div class="suggestion-details">
                  <div class="detail-row">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">{{ suggestion.description | default('No additional details available.') }}</div>
                  </div>
                </div>
              </div>
              {% endfor %}
              {% endif %}
            </div>

            <!-- Per-page suggestions -->
            {% for page in formatting_data.pages %}
            <div class="page-suggestions" data-page="{{ page.page_number }}">
              <div class="page-summary">{{ page.summary | default('Page ' ~ page.page_number ~ ' analysis') }}</div>
              
              {% if page.suggestions %}
              {% for suggestion in page.suggestions %}
              <div class="suggestion-card" 
                   data-title="{{ suggestion.title }}"
                   data-description="{{ suggestion.description | default('') }}"
                   data-fix="{{ suggestion.fix | default('') }}"
                   data-affected="{{ suggestion.affected_text | default('') }}"
                   data-page="{{ page.page_number }}"
                   data-location-y="{{ suggestion.location_y | default(0.3) }}"
                   data-location-x="{{ suggestion.location_x | default(0.5) }}"
                   data-location-width="{{ suggestion.location_width | default(0.4) }}"
                   data-location-height="{{ suggestion.location_height | default(0.05) }}">
                <div class="suggestion-header">
                  <div class="severity-icon severity-{{ suggestion.severity | default('info') }}">
                    {% if suggestion.severity == 'critical' %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                    {% elif suggestion.severity == 'major' %}
                    <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    {% elif suggestion.severity == 'minor' %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
                    {% else %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    {% endif %}
                  </div>
                  <div class="suggestion-main">
                    <span class="suggestion-type">{{ suggestion.type | default('general') }}</span>
                    <div class="suggestion-title">{{ suggestion.title }}</div>
                    <div class="suggestion-location">{{ suggestion.location | default('') }}</div>
                  </div>
                  <div class="suggestion-expand">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>
                  </div>
                </div>
                <div class="suggestion-details">
                  <div class="detail-row">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">{{ suggestion.description }}</div>
                  </div>
                  {% if suggestion.fix %}
                  <div class="detail-row">
                    <div class="detail-label">Suggested Fix</div>
                    <div class="detail-value">{{ suggestion.fix }}</div>
                  </div>
                  {% endif %}
                  {% if suggestion.affected_text %}
                  <div class="detail-row">
                    <div class="detail-label">Affected Text</div>
                    <div class="detail-value affected-text">{{ suggestion.affected_text }}</div>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>Looking Good!</h4>
                <p>No significant formatting issues detected on this page.</p>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="suggestions-content">
            <div class="empty-state">
              <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
              <h4>Analysis Unavailable</h4>
              <p>Could not generate formatting suggestions for this document.</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <div class="actions">
        <a href="/" class="btn btn-secondary">
          <svg viewBox="0 0 24 24" style="width: 18px; height: 18px;"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
          Upload Another
        </a>
        <button class="btn btn-primary" onclick="downloadText()">
          <svg viewBox="0 0 24 24" style="width: 18px; height: 18px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
          Download Text
        </button>
      </div>
    </div>
  </div>

  <script>
    // PDF.js initialization
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // Store extracted text for download
    const extractedText = {{ extracted_text | tojson }};
    const isPdf = {{ is_pdf | tojson if is_pdf is defined else 'false' }};
    const pdfBase64 = {{ pdf_base64 | tojson if pdf_base64 else 'null' }};

    // PDF Viewer State
    let pdfDoc = null;
    let currentPage = 1;
    let totalPages = 0;
    let scale = 1.5;
    let rendering = false;

    // DOM Elements
    const pdfCanvas = document.getElementById('pdf-canvas');
    const pdfContainer = document.getElementById('pdf-container');
    const pdfWrapper = document.getElementById('pdf-wrapper');
    const pdfLoading = document.getElementById('pdf-loading');
    const highlightOverlay = document.getElementById('highlight-overlay');
    const scanLine = document.getElementById('scan-line');
    const connectionLine = document.getElementById('connection-line');
    const connectionPath = document.getElementById('connection-path');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesSpan = document.getElementById('total-pages');

    // Initialize PDF if available
    if (isPdf && pdfBase64) {
      loadPdf();
    }

    async function loadPdf() {
      try {
        const pdfData = atob(pdfBase64);
        const pdfArray = new Uint8Array(pdfData.length);
        for (let i = 0; i < pdfData.length; i++) {
          pdfArray[i] = pdfData.charCodeAt(i);
        }

        pdfDoc = await pdfjsLib.getDocument({ data: pdfArray }).promise;
        totalPages = pdfDoc.numPages;
        totalPagesSpan.textContent = totalPages;

        // Render first page
        await renderPage(1);

        // Show PDF
        pdfLoading.style.display = 'none';
        pdfWrapper.style.display = 'block';

        // Enable/disable navigation
        updateNavButtons();
      } catch (error) {
        console.error('PDF loading error:', error);
        pdfLoading.innerHTML = '<span style="color: #ef4444;">Failed to load PDF</span>';
      }
    }

    async function renderPage(pageNum) {
      if (rendering) return;
      rendering = true;

      try {
        const page = await pdfDoc.getPage(pageNum);
        
        // Calculate scale to fit container
        const containerWidth = pdfContainer.clientWidth - 40;
        const containerHeight = pdfContainer.clientHeight - 40;
        
        const viewport = page.getViewport({ scale: 1 });
        const scaleX = containerWidth / viewport.width;
        const scaleY = containerHeight / viewport.height;
        scale = Math.min(scaleX, scaleY, 2);

        const scaledViewport = page.getViewport({ scale });
        
        pdfCanvas.width = scaledViewport.width;
        pdfCanvas.height = scaledViewport.height;

        const ctx = pdfCanvas.getContext('2d');
        await page.render({
          canvasContext: ctx,
          viewport: scaledViewport
        }).promise;

        currentPage = pageNum;
        currentPageSpan.textContent = pageNum;
        updateNavButtons();

        // Clear highlights when changing pages
        clearHighlights();
      } catch (error) {
        console.error('Page render error:', error);
      } finally {
        rendering = false;
      }
    }

    function updateNavButtons() {
      if (prevBtn) prevBtn.disabled = currentPage <= 1;
      if (nextBtn) nextBtn.disabled = currentPage >= totalPages;
    }

    // Navigation event listeners
    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          renderPage(currentPage - 1);
        }
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          renderPage(currentPage + 1);
        }
      });
    }

    // Text functions
    function copyText() {
      navigator.clipboard.writeText(extractedText).then(() => {
        showNotification('Text copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }

    function downloadText() {
      const filename = '{{ filename }}'.replace(/\.[^/.]+$/, '') + '_extracted.txt';
      const blob = new Blob([extractedText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        background: linear-gradient(135deg, rgba(138, 243, 255, 0.9), rgba(94, 210, 255, 0.9));
        color: #050505;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        z-index: 10000;
        box-shadow: 0 10px 40px rgba(138, 243, 255, 0.4);
        animation: fadeInUp 0.3s ease-out;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(-50%) translateY(10px)';
        notification.style.transition = 'all 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    // Page tab switching
    const pageTabs = document.querySelectorAll('.page-tab');
    const pageSuggestions = document.querySelectorAll('.page-suggestions');

    pageTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const pageNum = tab.dataset.page;
        
        // Update active tab
        pageTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding suggestions
        pageSuggestions.forEach(ps => {
          if (ps.dataset.page === pageNum) {
            ps.classList.add('active');
          } else {
            ps.classList.remove('active');
          }
        });

        // If PDF and page number, navigate to that page
        if (isPdf && pdfDoc && pageNum !== 'overall') {
          const targetPage = parseInt(pageNum);
          if (targetPage && targetPage !== currentPage) {
            renderPage(targetPage);
          }
        }
      });
    });

    // Suggestion card expand/collapse and highlight mapping
    const suggestionCards = document.querySelectorAll('.suggestion-card');

    suggestionCards.forEach(card => {
      card.addEventListener('click', (e) => {
        const wasExpanded = card.classList.contains('expanded');
        suggestionCards.forEach(c => c.classList.remove('expanded'));
        if (!wasExpanded) {
          card.classList.add('expanded');
        }
      });

      // Hover effects with PDF highlight mapping
      card.addEventListener('mouseenter', () => {
        if (isPdf && pdfDoc) {
          const pageNum = parseInt(card.dataset.page);
          
          // Navigate to the relevant page if needed
          if (pageNum && pageNum !== currentPage && pageNum > 0) {
            renderPage(pageNum).then(() => {
              showHighlightOnPdf(card);
            });
          } else if (pageNum > 0) {
            showHighlightOnPdf(card);
          }
        }
      });

      card.addEventListener('mouseleave', () => {
        clearHighlights();
        hideConnectionLine();
      });
    });

    function showHighlightOnPdf(card) {
      if (!highlightOverlay || !pdfCanvas) return;

      // Get location data from card (normalized 0-1 values)
      const locY = parseFloat(card.dataset.locationY) || 0.3;
      const locX = parseFloat(card.dataset.locationX) || 0.1;
      const locWidth = parseFloat(card.dataset.locationWidth) || 0.8;
      const locHeight = parseFloat(card.dataset.locationHeight) || 0.06;

      // Clear existing highlights
      highlightOverlay.innerHTML = '';

      // Create highlight box
      const highlightBox = document.createElement('div');
      highlightBox.className = 'highlight-box';
      
      // Position based on normalized coordinates (0-1 range)
      highlightBox.style.left = (locX * 100) + '%';
      highlightBox.style.top = (locY * 100) + '%';
      highlightBox.style.width = (locWidth * 100) + '%';
      highlightBox.style.height = Math.max(locHeight * 100, 3) + '%';

      highlightOverlay.appendChild(highlightBox);

      // Animate in
      requestAnimationFrame(() => {
        highlightBox.classList.add('active');
      });

      // Show scan line effect
      if (scanLine) {
        scanLine.style.top = '0';
        scanLine.classList.add('active');
        setTimeout(() => {
          scanLine.classList.remove('active');
        }, 1500);
      }

      // Draw connection line after a short delay to ensure highlight is rendered
      setTimeout(() => {
        drawConnectionLine(card, highlightBox);
      }, 50);
    }

    function drawConnectionLine(card, highlightBox) {
      if (!connectionLine || !connectionPath) return;

      // Get bounding rectangles
      const cardRect = card.getBoundingClientRect();
      const highlightRect = highlightBox.getBoundingClientRect();
      const pdfWrapperRect = pdfWrapper ? pdfWrapper.getBoundingClientRect() : null;

      // Check if elements are visible
      if (!highlightRect.width || !highlightRect.height) return;

      // Start point: left center of the suggestion card
      const startX = cardRect.left;
      const startY = cardRect.top + (cardRect.height / 2);

      // End point: right center of the highlight box
      const endX = highlightRect.right;
      const endY = highlightRect.top + (highlightRect.height / 2);

      // Calculate control points for smooth curve
      const deltaX = Math.abs(startX - endX);
      const controlOffset = Math.min(deltaX * 0.4, 150);

      // Create path from highlight to card (right to left)
      const pathD = `M ${endX} ${endY} C ${endX + controlOffset} ${endY}, ${startX - controlOffset} ${startY}, ${startX} ${startY}`;
      
      connectionPath.setAttribute('d', pathD);
      
      // Position SVG to cover the entire viewport
      connectionLine.style.position = 'fixed';
      connectionLine.style.width = '100vw';
      connectionLine.style.height = '100vh';
      connectionLine.style.left = '0';
      connectionLine.style.top = '0';
      connectionLine.style.pointerEvents = 'none';
      connectionLine.classList.add('active');
    }

    function clearHighlights() {
      if (highlightOverlay) {
        highlightOverlay.innerHTML = '';
      }
    }

    function hideConnectionLine() {
      if (connectionLine) {
        connectionLine.classList.remove('active');
      }
    }

    // Tooltip functionality
    const tooltip = document.getElementById('tooltip');
    const tooltipTitle = tooltip.querySelector('.tooltip-title');
    const tooltipDesc = tooltip.querySelector('.tooltip-desc');
    const tooltipFix = tooltip.querySelector('.tooltip-fix');
    let tooltipTimeout;

    suggestionCards.forEach(card => {
      card.addEventListener('mouseenter', (e) => {
        clearTimeout(tooltipTimeout);
        
        const title = card.dataset.title || '';
        const description = card.dataset.description || '';
        const fix = card.dataset.fix || '';
        
        if (title || description) {
          tooltipTitle.textContent = title;
          tooltipDesc.textContent = description.substring(0, 150) + (description.length > 150 ? '...' : '');
          tooltipFix.textContent = fix ? 'ðŸ’¡ ' + fix.substring(0, 100) + (fix.length > 100 ? '...' : '') : '';
          tooltipFix.style.display = fix ? 'block' : 'none';
          
          tooltipTimeout = setTimeout(() => {
            positionTooltip(e);
            tooltip.classList.add('visible');
          }, 400);
        }
      });

      card.addEventListener('mousemove', (e) => {
        if (tooltip.classList.contains('visible')) {
          positionTooltip(e);
        }
      });

      card.addEventListener('mouseleave', () => {
        clearTimeout(tooltipTimeout);
        tooltip.classList.remove('visible');
      });
    });

    function positionTooltip(e) {
      const x = e.clientX + 15;
      const y = e.clientY + 15;
      
      const tooltipRect = tooltip.getBoundingClientRect();
      const maxX = window.innerWidth - tooltipRect.width - 20;
      const maxY = window.innerHeight - tooltipRect.height - 20;
      
      tooltip.style.left = Math.min(x, maxX) + 'px';
      tooltip.style.top = Math.min(y, maxY) + 'px';
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        suggestionCards.forEach(c => c.classList.remove('expanded'));
        tooltip.classList.remove('visible');
        clearHighlights();
        hideConnectionLine();
      }
      
      // Arrow keys for PDF navigation
      if (isPdf && pdfDoc) {
        if (e.key === 'ArrowLeft' && currentPage > 1) {
          renderPage(currentPage - 1);
        } else if (e.key === 'ArrowRight' && currentPage < totalPages) {
          renderPage(currentPage + 1);
        }
      }
    });

    // Resize handler
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (isPdf && pdfDoc && currentPage) {
          renderPage(currentPage);
        }
      }, 200);
    });
  </script>
</body>
</html>
