<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReviewerAI - Analysis Results</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; min-height: 100%; font-family: 'Space Grotesk', 'Sora', system-ui, -apple-system, sans-serif; }
    body { 
      background: radial-gradient(circle at 20% 20%, #121212, #090909 35%, #050505 70%, #000); 
      color: #ffffff; 
      overflow-x: hidden; 
      position: relative; 
    }
    body::after { 
      content: ''; 
      position: fixed; 
      inset: 0; 
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.06'/%3E%3C/svg%3E"); 
      pointer-events: none; 
      z-index: 1; 
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }

    @keyframes fadeInUp { 
      from { opacity: 0; transform: translateY(40px); } 
      to { opacity: 1; transform: translateY(0); } 
    }

    @keyframes pulse { 
      0%, 100% { opacity: 0.6; } 
      50% { opacity: 1; } 
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    @keyframes scanLine {
      0% { top: 0; opacity: 1; }
      100% { top: 100%; opacity: 0.3; }
    }

    @keyframes highlightPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(138, 243, 255, 0.5), inset 0 0 10px rgba(138, 243, 255, 0.1); }
      50% { box-shadow: 0 0 25px rgba(138, 243, 255, 0.8), inset 0 0 20px rgba(138, 243, 255, 0.2); }
    }

    /* Background */
    .background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; }
    .bg-orb { position: absolute; border-radius: 50%; filter: blur(80px); }
    .orb-1 { width: 420px; height: 420px; background: radial-gradient(circle, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.04)); top: -40px; left: 8%; animation: blob 8s ease-in-out infinite; }
    .orb-2 { width: 420px; height: 420px; background: radial-gradient(circle, rgba(255, 255, 255, 0.14), rgba(0, 0, 0, 0)); bottom: 5%; right: 4%; animation: blob-2 10s ease-in-out infinite; }
    .orb-3 { width: 360px; height: 360px; background: radial-gradient(circle, rgba(255, 255, 255, 0.22), rgba(0, 0, 0, 0)); top: 50%; left: 50%; transform: translate(-50%, -50%); animation: blob-3 12s ease-in-out infinite; }
    
    @keyframes blob { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(20px, -30px) scale(1.1); } 50% { transform: translate(-20px, 20px) scale(0.95); } 75% { transform: translate(30px, 10px) scale(1.05); } }
    @keyframes blob-2 { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(-30px, 20px) scale(0.95); } 50% { transform: translate(25px, -15px) scale(1.1); } 75% { transform: translate(-15px, -25px) scale(0.98); } }
    @keyframes blob-3 { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 25% { transform: translate(calc(-50% + 15px), calc(-50% - 20px)) scale(1.08); } 50% { transform: translate(calc(-50% - 20px), calc(-50% + 15px)) scale(0.92); } 75% { transform: translate(calc(-50% + 25px), calc(-50% + 20px)) scale(1.05); } }

    .grid-overlay { 
      position: absolute; 
      inset: 0; 
      background-image: linear-gradient(to right, rgba(255, 255, 255, 0.04) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.04) 1px, transparent 1px); 
      background-size: 4rem 4rem; 
      mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, #000 70%, transparent 100%); 
    }
    .vignette { position: absolute; inset: -8%; pointer-events: none; background: radial-gradient(circle at center, transparent 52%, rgba(0, 0, 0, 0.35) 75%, rgba(0, 0, 0, 0.55) 100%); mix-blend-mode: multiply; opacity: 0.6; }

    /* Corner badge */
    .corner-badge { position: fixed; bottom: 16px; right: 16px; z-index: 9999; display: flex; align-items: center; gap: 8px; padding: 12px 18px; background: linear-gradient(135deg, rgba(12,14,18,0.96), rgba(6,8,12,0.98)); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; box-shadow: 0 10px 32px rgba(0,0,0,0.6); backdrop-filter: blur(12px); pointer-events: none; }
    .corner-badge-dot { width: 8px; height: 8px; border-radius: 50%; background: linear-gradient(135deg, #8af3ff, #5ed2ff); box-shadow: 0 0 10px rgba(138,243,255,0.8); animation: badgePulse 2s ease-in-out infinite; }
    .corner-badge-text { font-size: 12px; font-weight: 700; letter-spacing: 1.5px; color: rgba(255,255,255,0.85); text-transform: uppercase; }
    @keyframes badgePulse { 0%, 100% { opacity: 0.6; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } }

    /* Content */
    .content { position: relative; z-index: 10; padding: 40px 0 80px; }

    /* Header */
    .header { text-align: center; margin-bottom: 32px; animation: fadeInUp 0.8s ease-out forwards; }
    .header-title { font-size: clamp(28px, 4vw, 42px); font-weight: 700; margin-bottom: 8px; background: linear-gradient(120deg, #ffffff 0%, #ffffff 50%, #ffffff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header-subtitle { font-size: 14px; color: #ffffff; letter-spacing: 4px; text-transform: uppercase; }

    /* File info card */
    .file-info { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 24px; animation: fadeInUp 0.8s ease-out 0.1s forwards; opacity: 0; }
    .info-chip { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 12px; backdrop-filter: blur(10px); }
    .info-chip svg { width: 16px; height: 16px; color: #8af3ff; }
    .info-chip-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }
    .info-chip-value { font-size: 13px; font-weight: 600; color: #ffffff; }

    /* Score chip */
    .score-chip { background: linear-gradient(135deg, rgba(138, 243, 255, 0.1), rgba(94, 210, 255, 0.05)); border-color: rgba(138, 243, 255, 0.3); }
    .score-chip .info-chip-value { color: #8af3ff; font-size: 16px; }

    /* Main layout - Two columns */
    .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; animation: fadeInUp 0.8s ease-out 0.2s forwards; opacity: 0; }

    @media (max-width: 1024px) {
      .main-layout { grid-template-columns: 1fr; }
    }

    /* PDF Viewer Card */
    .pdf-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }
    .pdf-card-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .pdf-card-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .pdf-card-title svg { width: 20px; height: 20px; color: #8af3ff; }

    /* PDF Navigation */
    .pdf-nav { display: flex; align-items: center; gap: 12px; }
    .pdf-nav-btn { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.06); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; color: #ffffff; }
    .pdf-nav-btn:hover:not(:disabled) { background: rgba(138, 243, 255, 0.15); border-color: rgba(138, 243, 255, 0.4); }
    .pdf-nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .pdf-nav-btn svg { width: 16px; height: 16px; }
    .pdf-page-info { font-size: 13px; color: #9ca3af; min-width: 80px; text-align: center; }
    .pdf-page-info span { color: #8af3ff; font-weight: 600; }

    /* PDF Container */
    .pdf-container { position: relative; flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; background: rgba(0, 0, 0, 0.2); min-height: 60vh; overflow: hidden; }
    .pdf-wrapper { position: relative; display: inline-block; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); border-radius: 4px; overflow: hidden; }
    #pdf-canvas { display: block; max-width: 100%; height: auto; }

    /* Highlight Overlay */
    .highlight-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    .highlight-box { position: absolute; background: rgba(138, 243, 255, 0.2); border: 2px solid rgba(138, 243, 255, 0.6); border-radius: 4px; opacity: 0; transition: all 0.4s ease; }
    .highlight-box.active { opacity: 1; animation: highlightPulse 1.5s ease-in-out infinite; }

    /* Scan Line Effect */
    .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, transparent, rgba(138, 243, 255, 0.8), transparent); pointer-events: none; opacity: 0; z-index: 11; }
    .scan-line.active { animation: scanLine 1.5s ease-in-out; }

    /* Connection Line */
    .connection-line { position: fixed; pointer-events: none; z-index: 100; opacity: 0; transition: opacity 0.3s ease; }
    .connection-line.active { opacity: 1; }
    .connection-line svg { overflow: visible; }
    .connection-line path { stroke: #8af3ff; stroke-width: 2; fill: none; stroke-dasharray: 8 4; animation: dashMove 0.5s linear infinite; }
    @keyframes dashMove { to { stroke-dashoffset: -12; } }

    /* Text fallback card */
    .text-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }
    .text-card-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .text-card-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .text-card-title svg { width: 20px; height: 20px; color: #8af3ff; }
    .text-card-actions { display: flex; gap: 6px; }
    
    .text-content { padding: 20px; max-height: 55vh; overflow-y: auto; flex: 1; }
    .text-content pre { white-space: pre-wrap; word-wrap: break-word; font-family: 'Space Grotesk', monospace; font-size: 14px; line-height: 1.7; color: #e5e7eb; }

    /* Highlighted text */
    .text-content pre .highlight { background: rgba(138, 243, 255, 0.2); border-radius: 3px; padding: 2px 4px; transition: all 0.3s ease; }
    .text-content pre .highlight.active { background: rgba(138, 243, 255, 0.4); box-shadow: 0 0 20px rgba(138, 243, 255, 0.3); }

    /* Suggestions Panel */
    .suggestions-panel { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; backdrop-filter: blur(16px); box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; overflow: hidden; display: flex; flex-direction: column; }

    .suggestions-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.02); }
    .suggestions-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; }
    .suggestions-title svg { width: 20px; height: 20px; color: #8af3ff; }

    /* Page tabs */
    .page-tabs { display: flex; gap: 8px; padding: 12px 16px; border-bottom: 1px solid rgba(255, 255, 255, 0.06); overflow-x: auto; flex-shrink: 0; }
    .page-tabs::-webkit-scrollbar { height: 4px; }
    .page-tabs::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .page-tabs::-webkit-scrollbar-thumb { background: rgba(138, 243, 255, 0.3); border-radius: 2px; }

    .page-tab { padding: 8px 16px; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 13px; font-weight: 500; color: #9ca3af; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; }
    .page-tab:hover { background: rgba(255, 255, 255, 0.08); color: #ffffff; border-color: rgba(255, 255, 255, 0.2); }
    .page-tab.active { background: linear-gradient(135deg, rgba(138, 243, 255, 0.15), rgba(94, 210, 255, 0.1)); border-color: rgba(138, 243, 255, 0.4); color: #8af3ff; }
    .page-tab .score-badge { display: inline-block; margin-left: 8px; padding: 2px 6px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; font-size: 11px; }

    /* Suggestions content */
    .suggestions-content { padding: 16px; max-height: 55vh; overflow-y: auto; flex: 1; }

    /* Overall summary */
    .overall-summary { margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(138, 243, 255, 0.06), rgba(94, 210, 255, 0.03)); border: 1px solid rgba(138, 243, 255, 0.15); border-radius: 14px; }
    .summary-grade { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; }
    .grade-circle { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; background: linear-gradient(135deg, #8af3ff, #5ed2ff); color: #050505; box-shadow: 0 8px 24px rgba(138, 243, 255, 0.3); }
    .grade-info h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .grade-info p { font-size: 13px; color: #9ca3af; }

    .summary-lists { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .summary-list { padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
    .summary-list h5 { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8af3ff; margin-bottom: 8px; }
    .summary-list ul { list-style: none; font-size: 12px; color: #d1d5db; }
    .summary-list li { padding: 4px 0; padding-left: 16px; position: relative; }
    .summary-list li::before { content: 'â†’'; position: absolute; left: 0; color: #8af3ff; }

    /* Page suggestions */
    .page-suggestions { display: none; }
    .page-suggestions.active { display: block; }

    .page-summary { font-size: 13px; color: #9ca3af; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.06); }

    /* Suggestion card */
    .suggestion-card { padding: 14px; margin-bottom: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
    .suggestion-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: #8af3ff; opacity: 0; transition: opacity 0.3s ease; }
    .suggestion-card:hover { background: rgba(255, 255, 255, 0.06); border-color: rgba(138, 243, 255, 0.3); transform: translateX(4px); }
    .suggestion-card:hover::before { opacity: 1; }
    .suggestion-card.expanded { background: rgba(138, 243, 255, 0.08); border-color: rgba(138, 243, 255, 0.4); }
    .suggestion-card.expanded::before { opacity: 1; }

    .suggestion-header { display: flex; align-items: flex-start; gap: 12px; }

    .severity-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .severity-icon svg { width: 18px; height: 18px; }
    .severity-critical { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .severity-major { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .severity-minor { background: rgba(138, 243, 255, 0.2); color: #8af3ff; }
    .severity-info { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }

    .suggestion-main { flex: 1; min-width: 0; }
    .suggestion-type { display: inline-block; padding: 3px 8px; background: rgba(255, 255, 255, 0.08); border-radius: 6px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #9ca3af; margin-bottom: 6px; }
    .suggestion-title { font-size: 14px; font-weight: 600; color: #ffffff; margin-bottom: 4px; }
    .suggestion-location { font-size: 12px; color: #6b7280; }

    .suggestion-expand { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 6px; background: rgba(255, 255, 255, 0.05); transition: all 0.3s ease; flex-shrink: 0; }
    .suggestion-expand svg { width: 14px; height: 14px; color: #9ca3af; transition: transform 0.3s ease; }
    .suggestion-card.expanded .suggestion-expand svg { transform: rotate(180deg); }

    .suggestion-details { display: none; margin-top: 14px; padding-top: 14px; border-top: 1px solid rgba(255, 255, 255, 0.06); }
    .suggestion-card.expanded .suggestion-details { display: block; }

    .detail-row { margin-bottom: 12px; }
    .detail-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #6b7280; margin-bottom: 4px; }
    .detail-value { font-size: 13px; color: #d1d5db; line-height: 1.5; }
    .detail-value.affected-text { padding: 8px 12px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-family: monospace; font-size: 12px; word-break: break-all; }

    /* Buttons */
    .btn { cursor: pointer; border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; font-size: 14px; transition: all 0.4s ease; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
    .btn-primary { 
      background: linear-gradient(135deg, #ffffff, #b5b5b5 50%, #ffffff); 
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #050505; 
      box-shadow: 0 18px 50px rgba(255, 255, 255, 0.12); 
    }
    .btn-primary:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 22px 60px rgba(255, 255, 255, 0.18); }
    .btn-secondary { 
      background: rgba(255, 255, 255, 0.04); 
      border: 1px solid rgba(255, 255, 255, 0.18); 
      color: #f5f5f5; 
      backdrop-filter: blur(12px);
    }
    .btn-secondary:hover { transform: translateY(-2px) scale(1.02); border-color: rgba(255, 255, 255, 0.35); box-shadow: 0 16px 40px rgba(255, 255, 255, 0.12); }
    .btn-icon { padding: 10px; border-radius: 10px; }

    /* Actions */
    .actions { display: flex; gap: 16px; justify-content: center; margin-top: 32px; animation: fadeInUp 0.8s ease-out 0.3s forwards; opacity: 0; }

    /* Scrollbar */
    .text-content::-webkit-scrollbar, .suggestions-content::-webkit-scrollbar { width: 6px; }
    .text-content::-webkit-scrollbar-track, .suggestions-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 3px; }
    .text-content::-webkit-scrollbar-thumb, .suggestions-content::-webkit-scrollbar-thumb { background: rgba(138, 243, 255, 0.3); border-radius: 3px; }
    .text-content::-webkit-scrollbar-thumb:hover, .suggestions-content::-webkit-scrollbar-thumb:hover { background: rgba(138, 243, 255, 0.5); }

    /* SVG Icons */
    svg { fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* Loading state */
    .loading-shimmer { background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }

    .pdf-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; color: #9ca3af; }
    .pdf-loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(138, 243, 255, 0.2); border-top-color: #8af3ff; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Empty state */
    .empty-state { text-align: center; padding: 40px 20px; color: #6b7280; }
    .empty-state svg { width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state h4 { font-size: 16px; color: #9ca3af; margin-bottom: 8px; }
    .empty-state p { font-size: 13px; }

    /* Tooltip */
    .tooltip { position: fixed; z-index: 9999; padding: 10px 14px; background: rgba(20, 20, 25, 0.98); border: 1px solid rgba(138, 243, 255, 0.3); border-radius: 10px; font-size: 13px; color: #ffffff; max-width: 300px; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6); pointer-events: none; opacity: 0; transform: translateY(8px); transition: all 0.2s ease; }
    .tooltip.visible { opacity: 1; transform: translateY(0); }
    .tooltip-title { font-weight: 600; margin-bottom: 6px; color: #8af3ff; }
    .tooltip-fix { font-size: 12px; color: #9ca3af; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }

    /* Responsive */
    @media (max-width: 640px) {
      .pdf-card-header, .text-card-header, .suggestions-header { flex-direction: column; gap: 12px; align-items: flex-start; }
      .actions { flex-direction: column; }
      .actions .btn { width: 100%; justify-content: center; }
      .summary-lists { grid-template-columns: 1fr; }
    }

    /* ==================== PLAGIARISM PANEL STYLES ==================== */
    .plagiarism-section { 
      margin-top: 32px; 
      animation: fadeInUp 0.8s ease-out 0.4s forwards; 
      opacity: 0; 
    }

    .plagiarism-panel { 
      background: rgba(255, 255, 255, 0.03); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 20px; 
      backdrop-filter: blur(16px); 
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset; 
      overflow: hidden; 
    }

    .plagiarism-header { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 20px 24px; 
      border-bottom: 1px solid rgba(255, 255, 255, 0.08); 
      background: rgba(255, 255, 255, 0.02); 
    }

    .plagiarism-title { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      font-size: 18px; 
      font-weight: 600; 
    }

    .plagiarism-title svg { width: 24px; height: 24px; color: #8af3ff; }

    /* Score circle */
    .score-circle-container { display: flex; align-items: center; gap: 16px; }

    .score-circle { 
      position: relative; 
      width: 72px; 
      height: 72px; 
    }

    .score-circle svg { 
      transform: rotate(-90deg); 
      width: 72px; 
      height: 72px; 
    }

    .score-circle-bg { 
      fill: none; 
      stroke: rgba(255, 255, 255, 0.1); 
      stroke-width: 6; 
    }

    .score-circle-progress { 
      fill: none; 
      stroke-width: 6; 
      stroke-linecap: round; 
      transition: stroke-dashoffset 1s ease-out; 
    }

    .score-circle-progress.low-risk { stroke: #10b981; }
    .score-circle-progress.moderate-risk { stroke: #fbbf24; }
    .score-circle-progress.elevated-risk { stroke: #f97316; }
    .score-circle-progress.high-risk { stroke: #ef4444; }

    .score-circle-text { 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      font-size: 18px; 
      font-weight: 700; 
      color: #ffffff; 
    }

    .score-info { text-align: left; }
    .score-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #9ca3af; margin-bottom: 4px; }
    .score-value { font-size: 24px; font-weight: 700; }
    .score-value.low-risk { color: #10b981; }
    .score-value.moderate-risk { color: #fbbf24; }
    .score-value.elevated-risk { color: #f97316; }
    .score-value.high-risk { color: #ef4444; }

    /* Risk badge */
    .risk-badge { 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
      padding: 6px 14px; 
      border-radius: 20px; 
      font-size: 12px; 
      font-weight: 600; 
      text-transform: uppercase; 
      letter-spacing: 0.5px; 
    }

    .risk-badge.low { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
    .risk-badge.moderate { background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }
    .risk-badge.elevated { background: rgba(249, 115, 22, 0.15); color: #f97316; border: 1px solid rgba(249, 115, 22, 0.3); }
    .risk-badge.high { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }

    .risk-badge svg { width: 14px; height: 14px; }

    /* Plagiarism content */
    .plagiarism-content { padding: 24px; }

    /* Component scores grid */
    .component-scores { 
      display: grid; 
      grid-template-columns: repeat(5, 1fr); 
      gap: 12px; 
      margin-bottom: 24px; 
    }

    @media (max-width: 900px) {
      .component-scores { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 600px) {
      .component-scores { grid-template-columns: repeat(2, 1fr); }
    }

    .component-score-card { 
      padding: 16px; 
      background: rgba(255, 255, 255, 0.03); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 14px; 
      text-align: center; 
      transition: all 0.3s ease; 
    }

    .component-score-card:hover { 
      background: rgba(255, 255, 255, 0.06); 
      border-color: rgba(138, 243, 255, 0.2); 
      transform: translateY(-2px); 
    }

    .component-icon { 
      width: 36px; 
      height: 36px; 
      margin: 0 auto 10px; 
      border-radius: 10px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }

    .component-icon svg { width: 20px; height: 20px; }
    .component-icon.green { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .component-icon.yellow { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .component-icon.orange { background: rgba(249, 115, 22, 0.15); color: #f97316; }
    .component-icon.red { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .component-icon.cyan { background: rgba(138, 243, 255, 0.15); color: #8af3ff; }

    .component-score-value { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .component-score-value.excellent { color: #10b981; }
    .component-score-value.good { color: #8af3ff; }
    .component-score-value.moderate { color: #fbbf24; }
    .component-score-value.poor { color: #ef4444; }

    .component-score-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Analysis tabs */
    .analysis-tabs { 
      display: flex; 
      gap: 8px; 
      padding: 12px 0; 
      margin-bottom: 16px; 
      border-bottom: 1px solid rgba(255, 255, 255, 0.08); 
      overflow-x: auto; 
    }

    .analysis-tab { 
      padding: 10px 18px; 
      background: rgba(255, 255, 255, 0.04); 
      border: 1px solid rgba(255, 255, 255, 0.1); 
      border-radius: 10px; 
      font-size: 13px; 
      font-weight: 500; 
      color: #9ca3af; 
      cursor: pointer; 
      transition: all 0.3s ease; 
      white-space: nowrap; 
    }

    .analysis-tab:hover { background: rgba(255, 255, 255, 0.08); color: #ffffff; }
    .analysis-tab.active { 
      background: linear-gradient(135deg, rgba(138, 243, 255, 0.15), rgba(94, 210, 255, 0.1)); 
      border-color: rgba(138, 243, 255, 0.4); 
      color: #8af3ff; 
    }

    /* Analysis panels */
    .analysis-panel { display: none; }
    .analysis-panel.active { display: block; animation: fadeInUp 0.4s ease-out; }

    /* Issues list */
    .issues-list { margin-bottom: 20px; }

    .issue-item { 
      display: flex; 
      align-items: flex-start; 
      gap: 12px; 
      padding: 14px 16px; 
      background: rgba(255, 255, 255, 0.02); 
      border: 1px solid rgba(255, 255, 255, 0.06); 
      border-radius: 12px; 
      margin-bottom: 10px; 
    }

    .issue-icon { 
      width: 28px; 
      height: 28px; 
      border-radius: 8px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      flex-shrink: 0; 
    }

    .issue-icon svg { width: 16px; height: 16px; }
    .issue-icon.high { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .issue-icon.medium { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .issue-icon.low { background: rgba(138, 243, 255, 0.15); color: #8af3ff; }

    .issue-content { flex: 1; }
    .issue-type { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #6b7280; margin-bottom: 4px; }
    .issue-message { font-size: 14px; color: #e5e7eb; }

    /* Duplicate items */
    .duplicate-item { 
      padding: 14px; 
      background: rgba(239, 68, 68, 0.05); 
      border: 1px solid rgba(239, 68, 68, 0.15); 
      border-radius: 12px; 
      margin-bottom: 12px; 
    }

    .duplicate-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .duplicate-type { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #ef4444; }
    .duplicate-similarity { font-size: 12px; color: #fbbf24; font-weight: 600; }

    .duplicate-text { 
      font-family: monospace; 
      font-size: 12px; 
      color: #d1d5db; 
      padding: 10px; 
      background: rgba(0, 0, 0, 0.3); 
      border-radius: 8px; 
      word-break: break-word; 
    }

    /* Vocabulary stats */
    .vocab-stats { 
      display: grid; 
      grid-template-columns: repeat(4, 1fr); 
      gap: 12px; 
      margin-bottom: 20px; 
    }

    @media (max-width: 700px) {
      .vocab-stats { grid-template-columns: repeat(2, 1fr); }
    }

    .vocab-stat { 
      padding: 14px; 
      background: rgba(255, 255, 255, 0.03); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 12px; 
      text-align: center; 
    }

    .vocab-stat-value { font-size: 20px; font-weight: 700; color: #8af3ff; margin-bottom: 4px; }
    .vocab-stat-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Common phrases list */
    .phrase-list { max-height: 300px; overflow-y: auto; }

    .phrase-item { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 10px 14px; 
      background: rgba(255, 255, 255, 0.02); 
      border-radius: 8px; 
      margin-bottom: 8px; 
    }

    .phrase-text { font-size: 13px; color: #d1d5db; flex: 1; }
    .phrase-count { 
      font-size: 12px; 
      font-weight: 600; 
      padding: 3px 10px; 
      border-radius: 12px; 
      background: rgba(138, 243, 255, 0.1); 
      color: #8af3ff; 
    }

    /* Citation analysis */
    .citation-grid { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 12px; 
      margin-bottom: 20px; 
    }

    @media (max-width: 700px) {
      .citation-grid { grid-template-columns: 1fr; }
    }

    .citation-card { 
      padding: 16px; 
      background: rgba(255, 255, 255, 0.03); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 14px; 
    }

    .citation-card-header { font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .citation-card-value { font-size: 24px; font-weight: 700; color: #ffffff; }
    .citation-card-value.highlight { color: #8af3ff; }

    /* LLM Assessment */
    .llm-assessment { 
      padding: 16px; 
      background: linear-gradient(135deg, rgba(138, 243, 255, 0.06), rgba(94, 210, 255, 0.03)); 
      border: 1px solid rgba(138, 243, 255, 0.15); 
      border-radius: 14px; 
      margin-top: 20px; 
    }

    .llm-assessment-header { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 12px; 
      font-size: 14px; 
      font-weight: 600; 
      color: #8af3ff; 
    }

    .llm-assessment-header svg { width: 18px; height: 18px; }

    .llm-assessment-text { font-size: 14px; color: #d1d5db; line-height: 1.6; margin-bottom: 12px; }

    .llm-recommendations { list-style: none; }
    .llm-recommendations li { 
      padding: 8px 0 8px 20px; 
      position: relative; 
      font-size: 13px; 
      color: #9ca3af; 
    }
    .llm-recommendations li::before { 
      content: 'â†’'; 
      position: absolute; 
      left: 0; 
      color: #8af3ff; 
    }

    /* ==================== CITATION ANALYSIS SECTION ==================== */
    .citation-section {
      margin-top: 32px;
      animation: fadeInUp 0.8s ease-out 0.5s forwards;
      opacity: 0;
    }

    .citation-panel {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      backdrop-filter: blur(16px);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.06) inset;
      overflow: hidden;
    }

    .citation-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      flex-wrap: wrap;
      gap: 16px;
    }

    .citation-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 600;
    }

    .citation-title svg { width: 24px; height: 24px; color: #fbbf24; }

    /* Citation score ring */
    .citation-score-container { display: flex; align-items: center; gap: 20px; }

    .citation-score-ring {
      width: 70px;
      height: 70px;
      position: relative;
    }

    .citation-score-ring svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .citation-ring-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 6;
    }

    .citation-ring-progress {
      fill: none;
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s ease-out;
    }

    .citation-ring-progress.excellent { stroke: #10b981; }
    .citation-ring-progress.good { stroke: #8af3ff; }
    .citation-ring-progress.needs_improvement { stroke: #fbbf24; }
    .citation-ring-progress.poor { stroke: #ef4444; }

    .citation-score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      font-weight: 700;
    }

    .citation-score-text.excellent { color: #10b981; }
    .citation-score-text.good { color: #8af3ff; }
    .citation-score-text.needs_improvement { color: #fbbf24; }
    .citation-score-text.poor { color: #ef4444; }

    .citation-status { text-align: left; }
    .citation-status-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #9ca3af; margin-bottom: 4px; }
    .citation-status-value { font-size: 14px; font-weight: 600; }

    /* Citation content */
    .citation-content { padding: 24px; }

    /* Citation stats grid */
    .citation-stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    @media (max-width: 900px) { .citation-stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 500px) { .citation-stats-grid { grid-template-columns: 1fr; } }

    .citation-stat-card {
      padding: 16px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .citation-stat-card:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(251, 191, 36, 0.3);
    }

    .citation-stat-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
    }

    .citation-stat-icon svg { width: 18px; height: 18px; }
    .citation-stat-icon.gold { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .citation-stat-icon.green { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .citation-stat-icon.red { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .citation-stat-icon.cyan { background: rgba(138, 243, 255, 0.15); color: #8af3ff; }

    .citation-stat-value { font-size: 24px; font-weight: 700; color: #ffffff; margin-bottom: 4px; }
    .citation-stat-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Citation tabs */
    .citation-tabs {
      display: flex;
      gap: 8px;
      padding: 16px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 20px;
      overflow-x: auto;
    }

    .citation-tab {
      padding: 10px 18px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      color: #9ca3af;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .citation-tab:hover { background: rgba(255, 255, 255, 0.08); color: #ffffff; }
    .citation-tab.active {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.05));
      border-color: rgba(251, 191, 36, 0.4);
      color: #fbbf24;
    }

    /* Citation tab panels */
    .citation-tab-panel { display: none; }
    .citation-tab-panel.active { display: block; animation: fadeInUp 0.4s ease-out; }

    /* Issue cards for citations */
    .citation-issue-card {
      padding: 14px 16px;
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      border-left: 3px solid;
    }

    .citation-issue-card.critical { border-left-color: #ef4444; }
    .citation-issue-card.major { border-left-color: #fbbf24; }
    .citation-issue-card.minor { border-left-color: #8af3ff; }

    .citation-issue-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .citation-issue-type { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; padding: 3px 8px; border-radius: 6px; }
    .citation-issue-type.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .citation-issue-type.major { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .citation-issue-type.minor { background: rgba(138, 243, 255, 0.15); color: #8af3ff; }

    .citation-issue-title { font-size: 15px; font-weight: 600; color: #ffffff; }
    .citation-issue-description { font-size: 13px; color: #9ca3af; margin-bottom: 8px; line-height: 1.5; }
    .citation-issue-recommendation { font-size: 12px; color: #8af3ff; padding: 8px 12px; background: rgba(138, 243, 255, 0.05); border-radius: 8px; }
    .citation-issue-recommendation::before { content: 'ðŸ’¡ '; }

    /* Reference list */
    .reference-list { max-height: 400px; overflow-y: auto; }

    .reference-item {
      padding: 14px 16px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .reference-item:hover { background: rgba(255, 255, 255, 0.04); border-color: rgba(255, 255, 255, 0.12); }

    .reference-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .reference-number {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .reference-verification {
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .reference-verification.verified { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .reference-verification.unverified { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .reference-verification.partial { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }

    .reference-text { font-size: 13px; color: #d1d5db; line-height: 1.5; word-break: break-word; }
    .reference-meta { display: flex; gap: 12px; margin-top: 8px; flex-wrap: wrap; }
    .reference-meta-item { font-size: 11px; color: #6b7280; display: flex; align-items: center; gap: 4px; }
    .reference-meta-item svg { width: 12px; height: 12px; }

    /* Unsupported claims */
    .claim-item {
      padding: 14px 16px;
      margin-bottom: 12px;
      background: rgba(251, 191, 36, 0.05);
      border: 1px solid rgba(251, 191, 36, 0.2);
      border-radius: 10px;
    }

    .claim-type { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #fbbf24; margin-bottom: 6px; }
    .claim-context { font-size: 13px; color: #d1d5db; line-height: 1.5; }
    .claim-context mark { background: rgba(251, 191, 36, 0.3); color: #fbbf24; padding: 2px 4px; border-radius: 3px; }
    .claim-location { font-size: 11px; color: #6b7280; margin-top: 8px; }

    /* LLM Citation Assessment */
    .llm-citation-assessment {
      padding: 20px;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(251, 191, 36, 0.02));
      border: 1px solid rgba(251, 191, 36, 0.2);
      border-radius: 14px;
      margin-top: 20px;
    }

    .llm-citation-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      font-size: 15px;
      font-weight: 600;
      color: #fbbf24;
    }

    .llm-citation-header svg { width: 18px; height: 18px; }

    .credibility-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      margin-left: auto;
    }

    .credibility-badge.high { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .credibility-badge.medium { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .credibility-badge.low { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
  </style>
</head>
<body>
  <div class="background">
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>
    <div class="grid-overlay"></div>
    <div class="vignette"></div>
  </div>

  <div class="corner-badge">
    <div class="corner-badge-dot"></div>
    <span class="corner-badge-text">ReviewerAI</span>
  </div>

  <!-- Tooltip container -->
  <div id="tooltip" class="tooltip">
    <div class="tooltip-title"></div>
    <div class="tooltip-desc"></div>
    <div class="tooltip-fix"></div>
  </div>

  <!-- Connection line for mapping animation -->
  <div id="connection-line" class="connection-line">
    <svg width="100%" height="100%">
      <path id="connection-path" d="" />
    </svg>
  </div>

  <div class="content">
    <div class="container">
      <div class="header">
        <h1 class="header-title">Analysis Results</h1>
        <p class="header-subtitle">Research Paper Review</p>
      </div>

      <div class="file-info">
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
          <div>
            <div class="info-chip-label">File</div>
            <div class="info-chip-value">{{ filename }}</div>
          </div>
        </div>
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M4 7V4h16v3"></path><path d="M9 20h6"></path><path d="M12 4v16"></path></svg>
          <div>
            <div class="info-chip-label">Words</div>
            <div class="info-chip-value">{{ word_count | default(0) }}</div>
          </div>
        </div>
        <div class="info-chip">
          <svg viewBox="0 0 24 24"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
          <div>
            <div class="info-chip-label">Characters</div>
            <div class="info-chip-value">{{ char_count | default(0) }}</div>
          </div>
        </div>
        {% if formatting_data and formatting_data.score %}
        <div class="info-chip score-chip">
          <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
          <div>
            <div class="info-chip-label">Format Score</div>
            <div class="info-chip-value">{{ formatting_data.score }}/100</div>
          </div>
        </div>
        {% endif %}
      </div>

      <div class="main-layout">
        <!-- PDF Viewer Column -->
        {% if is_pdf and pdf_base64 %}
        <div class="pdf-card" id="pdf-card">
          <div class="pdf-card-header">
            <div class="pdf-card-title">
              <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
              Document Preview
            </div>
            <div class="pdf-nav">
              <button class="pdf-nav-btn" id="prev-page" disabled title="Previous Page">
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
              </button>
              <div class="pdf-page-info">
                Page <span id="current-page">1</span> of <span id="total-pages">-</span>
              </div>
              <button class="pdf-nav-btn" id="next-page" title="Next Page">
                <svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
              </button>
            </div>
          </div>
          <div class="pdf-container" id="pdf-container">
            <div class="pdf-loading" id="pdf-loading">
              <div class="pdf-loading-spinner"></div>
              <span>Loading PDF...</span>
            </div>
            <div class="pdf-wrapper" id="pdf-wrapper" style="display: none;">
              <canvas id="pdf-canvas"></canvas>
              <div class="highlight-overlay" id="highlight-overlay"></div>
              <div class="scan-line" id="scan-line"></div>
            </div>
          </div>
        </div>
        {% else %}
        <!-- Text fallback for non-PDF files -->
        <div class="text-card">
          <div class="text-card-header">
            <div class="text-card-title">
              <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
              Extracted Text
            </div>
            <div class="text-card-actions">
              <button class="btn btn-secondary btn-icon" onclick="copyText()" title="Copy to clipboard">
                <svg viewBox="0 0 24 24" style="width: 16px; height: 16px;"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
              </button>
              <button class="btn btn-secondary btn-icon" onclick="downloadText()" title="Download text">
                <svg viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              </button>
            </div>
          </div>
          <div class="text-content">
            <pre id="extracted-text">{{ extracted_text }}</pre>
          </div>
        </div>
        {% endif %}

        <!-- Formatting Suggestions Column -->
        <div class="suggestions-panel" id="suggestions-panel">
          <div class="suggestions-header">
            <div class="suggestions-title">
              <svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
              Formatting Suggestions
            </div>
          </div>

          {% if formatting_data and formatting_data.pages %}
          <!-- Page tabs -->
          <div class="page-tabs" id="page-tabs">
            <button class="page-tab active" data-page="overall">
              Overview
            </button>
            {% for page in formatting_data.pages %}
            <button class="page-tab" data-page="{{ page.page_number }}">
              Page {{ page.page_number }}
              <span class="score-badge">{{ page.page_score }}</span>
            </button>
            {% endfor %}
          </div>

          <div class="suggestions-content">
            <!-- Overall Summary -->
            <div class="page-suggestions active" data-page="overall">
              {% if formatting_data.overall %}
              <div class="overall-summary">
                <div class="summary-grade">
                  <div class="grade-circle">{{ formatting_data.overall.grade | default('B') }}</div>
                  <div class="grade-info">
                    <h4>Document Quality Score: {{ formatting_data.score }}/100</h4>
                    <p>{{ formatting_data.total_pages }} page(s) analyzed</p>
                  </div>
                </div>
                <div class="summary-lists">
                  {% if formatting_data.overall.strengths %}
                  <div class="summary-list">
                    <h5>Strengths</h5>
                    <ul>
                      {% for strength in formatting_data.overall.strengths[:3] %}
                      <li>{{ strength }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                  {% if formatting_data.overall.improvements_needed %}
                  <div class="summary-list">
                    <h5>Needs Improvement</h5>
                    <ul>
                      {% for improvement in formatting_data.overall.improvements_needed[:3] %}
                      <li>{{ improvement }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endif %}

              {% if formatting_data.overall and formatting_data.overall.suggestions %}
              {% for suggestion in formatting_data.overall.suggestions %}
              <div class="suggestion-card" 
                   data-title="{{ suggestion.title }}"
                   data-description="{{ suggestion.description | default('') }}"
                   data-fix=""
                   data-page="0">
                <div class="suggestion-header">
                  <div class="severity-icon severity-{{ suggestion.priority | default('medium') | replace('high', 'major') | replace('medium', 'minor') | replace('low', 'info') }}">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path></svg>
                  </div>
                  <div class="suggestion-main">
                    <span class="suggestion-type">{{ suggestion.type | default('structure') }}</span>
                    <div class="suggestion-title">{{ suggestion.title }}</div>
                  </div>
                  <div class="suggestion-expand">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>
                  </div>
                </div>
                <div class="suggestion-details">
                  <div class="detail-row">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">{{ suggestion.description | default('No additional details available.') }}</div>
                  </div>
                </div>
              </div>
              {% endfor %}
              {% endif %}
            </div>

            <!-- Per-page suggestions -->
            {% for page in formatting_data.pages %}
            <div class="page-suggestions" data-page="{{ page.page_number }}">
              <div class="page-summary">{{ page.summary | default('Page ' ~ page.page_number ~ ' analysis') }}</div>
              
              {% if page.suggestions %}
              {% for suggestion in page.suggestions %}
              <div class="suggestion-card" 
                   data-title="{{ suggestion.title }}"
                   data-description="{{ suggestion.description | default('') }}"
                   data-fix="{{ suggestion.fix | default('') }}"
                   data-affected="{{ suggestion.affected_text | default('') }}"
                   data-page="{{ page.page_number }}"
                   data-location-y="{{ suggestion.location_y | default(0.3) }}"
                   data-location-x="{{ suggestion.location_x | default(0.5) }}"
                   data-location-width="{{ suggestion.location_width | default(0.4) }}"
                   data-location-height="{{ suggestion.location_height | default(0.05) }}">
                <div class="suggestion-header">
                  <div class="severity-icon severity-{{ suggestion.severity | default('info') }}">
                    {% if suggestion.severity == 'critical' %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                    {% elif suggestion.severity == 'major' %}
                    <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    {% elif suggestion.severity == 'minor' %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
                    {% else %}
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    {% endif %}
                  </div>
                  <div class="suggestion-main">
                    <span class="suggestion-type">{{ suggestion.type | default('general') }}</span>
                    <div class="suggestion-title">{{ suggestion.title }}</div>
                    <div class="suggestion-location">{{ suggestion.location | default('') }}</div>
                  </div>
                  <div class="suggestion-expand">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>
                  </div>
                </div>
                <div class="suggestion-details">
                  <div class="detail-row">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">{{ suggestion.description }}</div>
                  </div>
                  {% if suggestion.fix %}
                  <div class="detail-row">
                    <div class="detail-label">Suggested Fix</div>
                    <div class="detail-value">{{ suggestion.fix }}</div>
                  </div>
                  {% endif %}
                  {% if suggestion.affected_text %}
                  <div class="detail-row">
                    <div class="detail-label">Affected Text</div>
                    <div class="detail-value affected-text">{{ suggestion.affected_text }}</div>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>Looking Good!</h4>
                <p>No significant formatting issues detected on this page.</p>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="suggestions-content">
            <div class="empty-state">
              <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
              <h4>Analysis Unavailable</h4>
              <p>Could not generate formatting suggestions for this document.</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Plagiarism Analysis Section -->
      {% if plagiarism_data %}
      <div class="plagiarism-section">
        <div class="plagiarism-panel">
          <div class="plagiarism-header">
            <div class="plagiarism-title">
              <svg viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="M9 12h6"></path><path d="M9 16h6"></path></svg>
              Plagiarism Analysis
            </div>
            <div class="score-circle-container">
              <div class="score-circle">
                <svg viewBox="0 0 36 36">
                  <circle class="score-circle-bg" cx="18" cy="18" r="15.5"></circle>
                  <circle 
                    class="score-circle-progress {% if plagiarism_data.overall_score >= 85 %}low-risk{% elif plagiarism_data.overall_score >= 70 %}moderate-risk{% elif plagiarism_data.overall_score >= 50 %}elevated-risk{% else %}high-risk{% endif %}" 
                    cx="18" cy="18" r="15.5"
                    stroke-dasharray="97.4"
                    stroke-dashoffset="{{ 97.4 - (plagiarism_data.overall_score / 100 * 97.4) }}"
                  ></circle>
                </svg>
                <span class="score-circle-text">{{ plagiarism_data.overall_score | round | int }}%</span>
              </div>
              <div class="score-info">
                <div class="score-label">Originality Score</div>
                <div class="score-value {% if plagiarism_data.overall_score >= 85 %}low-risk{% elif plagiarism_data.overall_score >= 70 %}moderate-risk{% elif plagiarism_data.overall_score >= 50 %}elevated-risk{% else %}high-risk{% endif %}">
                  {{ plagiarism_data.overall_score | round(1) }}/100
                </div>
              </div>
              <div class="risk-badge {{ plagiarism_data.risk_level }}">
                {% if plagiarism_data.risk_level == 'low' %}
                <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                {% elif plagiarism_data.risk_level == 'moderate' %}
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                {% elif plagiarism_data.risk_level == 'elevated' %}
                <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                {% else %}
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                {% endif %}
                {{ plagiarism_data.risk_level | capitalize }} Risk
              </div>
            </div>
          </div>

          <div class="plagiarism-content">
            <!-- Component Scores -->
            {% if plagiarism_data.component_scores %}
            <div class="component-scores">
              <div class="component-score-card">
                <div class="component-icon {% if plagiarism_data.component_scores.duplicate_check >= 85 %}green{% elif plagiarism_data.component_scores.duplicate_check >= 70 %}cyan{% elif plagiarism_data.component_scores.duplicate_check >= 50 %}yellow{% else %}red{% endif %}">
                  <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </div>
                <div class="component-score-value {% if plagiarism_data.component_scores.duplicate_check >= 85 %}excellent{% elif plagiarism_data.component_scores.duplicate_check >= 70 %}good{% elif plagiarism_data.component_scores.duplicate_check >= 50 %}moderate{% else %}poor{% endif %}">{{ plagiarism_data.component_scores.duplicate_check }}%</div>
                <div class="component-score-label">Duplicates</div>
              </div>
              <div class="component-score-card">
                <div class="component-icon {% if plagiarism_data.component_scores.vocabulary_richness >= 70 %}green{% elif plagiarism_data.component_scores.vocabulary_richness >= 50 %}cyan{% elif plagiarism_data.component_scores.vocabulary_richness >= 35 %}yellow{% else %}red{% endif %}">
                  <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                </div>
                <div class="component-score-value {% if plagiarism_data.component_scores.vocabulary_richness >= 70 %}excellent{% elif plagiarism_data.component_scores.vocabulary_richness >= 50 %}good{% elif plagiarism_data.component_scores.vocabulary_richness >= 35 %}moderate{% else %}poor{% endif %}">{{ plagiarism_data.component_scores.vocabulary_richness }}%</div>
                <div class="component-score-label">Vocabulary</div>
              </div>
              <div class="component-score-card">
                <div class="component-icon {% if plagiarism_data.component_scores.phrase_originality >= 85 %}green{% elif plagiarism_data.component_scores.phrase_originality >= 70 %}cyan{% elif plagiarism_data.component_scores.phrase_originality >= 50 %}yellow{% else %}red{% endif %}">
                  <svg viewBox="0 0 24 24"><line x1="17" y1="10" x2="3" y2="10"></line><line x1="21" y1="6" x2="3" y2="6"></line><line x1="21" y1="14" x2="3" y2="14"></line><line x1="17" y1="18" x2="3" y2="18"></line></svg>
                </div>
                <div class="component-score-value {% if plagiarism_data.component_scores.phrase_originality >= 85 %}excellent{% elif plagiarism_data.component_scores.phrase_originality >= 70 %}good{% elif plagiarism_data.component_scores.phrase_originality >= 50 %}moderate{% else %}poor{% endif %}">{{ plagiarism_data.component_scores.phrase_originality }}%</div>
                <div class="component-score-label">Originality</div>
              </div>
              <div class="component-score-card">
                <div class="component-icon {% if plagiarism_data.component_scores.style_consistency >= 80 %}green{% elif plagiarism_data.component_scores.style_consistency >= 60 %}cyan{% elif plagiarism_data.component_scores.style_consistency >= 40 %}yellow{% else %}red{% endif %}">
                  <svg viewBox="0 0 24 24"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                </div>
                <div class="component-score-value {% if plagiarism_data.component_scores.style_consistency >= 80 %}excellent{% elif plagiarism_data.component_scores.style_consistency >= 60 %}good{% elif plagiarism_data.component_scores.style_consistency >= 40 %}moderate{% else %}poor{% endif %}">{{ plagiarism_data.component_scores.style_consistency }}%</div>
                <div class="component-score-label">Style</div>
              </div>
              <div class="component-score-card">
                <div class="component-icon {% if plagiarism_data.component_scores.citation_quality >= 70 %}green{% elif plagiarism_data.component_scores.citation_quality >= 50 %}cyan{% elif plagiarism_data.component_scores.citation_quality >= 30 %}yellow{% else %}red{% endif %}">
                  <svg viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
                </div>
                <div class="component-score-value {% if plagiarism_data.component_scores.citation_quality >= 70 %}excellent{% elif plagiarism_data.component_scores.citation_quality >= 50 %}good{% elif plagiarism_data.component_scores.citation_quality >= 30 %}moderate{% else %}poor{% endif %}">{{ plagiarism_data.component_scores.citation_quality }}%</div>
                <div class="component-score-label">Citations</div>
              </div>
            </div>
            {% endif %}

            <!-- Issues -->
            {% if plagiarism_data.issues %}
            <div class="issues-list">
              <h4 style="font-size: 14px; font-weight: 600; color: #ffffff; margin-bottom: 12px;">Detected Issues</h4>
              {% for issue in plagiarism_data.issues %}
              <div class="issue-item">
                <div class="issue-icon {{ issue.severity }}">
                  {% if issue.severity == 'high' %}
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                  {% elif issue.severity == 'medium' %}
                  <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                  {% else %}
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  {% endif %}
                </div>
                <div class="issue-content">
                  <div class="issue-type">{{ issue.type | replace('_', ' ') }}</div>
                  <div class="issue-message">{{ issue.message }}</div>
                </div>
              </div>
              {% endfor %}
            </div>
            {% endif %}

            <!-- Analysis Tabs -->
            <div class="analysis-tabs" id="plagiarism-tabs">
              <button class="analysis-tab active" data-panel="duplicates">Duplicates</button>
              <button class="analysis-tab" data-panel="vocabulary">Vocabulary</button>
              <button class="analysis-tab" data-panel="phrases">Common Phrases</button>
              <button class="analysis-tab" data-panel="style">Style Analysis</button>
              <button class="analysis-tab" data-panel="citations">Citations</button>
            </div>

            <!-- Duplicates Panel -->
            <div class="analysis-panel active" data-panel="duplicates">
              {% if plagiarism_data.analyses and plagiarism_data.analyses.internal_duplicates %}
              {% set dups = plagiarism_data.analyses.internal_duplicates %}
              <p style="font-size: 14px; color: #9ca3af; margin-bottom: 16px;">
                Found {{ dups.duplicate_count }} internal duplicate(s) ({{ dups.duplicate_percentage }}% of content)
              </p>
              {% if dups.duplicates %}
              {% for dup in dups.duplicates[:5] %}
              <div class="duplicate-item">
                <div class="duplicate-header">
                  <span class="duplicate-type">{{ dup.type | replace('_', ' ') | title }}</span>
                  {% if dup.similarity %}
                  <span class="duplicate-similarity">{{ dup.similarity }}% similar</span>
                  {% endif %}
                </div>
                <div class="duplicate-text">"{{ dup.text }}"</div>
                {% if dup.similar_to %}
                <div style="margin-top: 8px; font-size: 12px; color: #6b7280;">Similar to:</div>
                <div class="duplicate-text" style="margin-top: 4px; opacity: 0.7;">"{{ dup.similar_to }}"</div>
                {% endif %}
              </div>
              {% endfor %}
              {% else %}
              <div class="empty-state" style="padding: 20px;">
                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>No Duplicates Found</h4>
                <p>Great! No significant internal duplicate content detected.</p>
              </div>
              {% endif %}
              {% endif %}
            </div>

            <!-- Vocabulary Panel -->
            <div class="analysis-panel" data-panel="vocabulary">
              {% if plagiarism_data.analyses and plagiarism_data.analyses.vocabulary %}
              {% set vocab = plagiarism_data.analyses.vocabulary %}
              <div class="vocab-stats">
                <div class="vocab-stat">
                  <div class="vocab-stat-value">{{ vocab.total_words | default(0) }}</div>
                  <div class="vocab-stat-label">Total Words</div>
                </div>
                <div class="vocab-stat">
                  <div class="vocab-stat-value">{{ vocab.unique_words | default(0) }}</div>
                  <div class="vocab-stat-label">Unique Words</div>
                </div>
                <div class="vocab-stat">
                  <div class="vocab-stat-value">{{ vocab.vocabulary_richness | default(0) }}%</div>
                  <div class="vocab-stat-label">Type-Token Ratio</div>
                </div>
                <div class="vocab-stat">
                  <div class="vocab-stat-value">{{ vocab.hapax_legomena | default(0) }}</div>
                  <div class="vocab-stat-label">Hapax Legomena</div>
                </div>
              </div>
              <p style="font-size: 13px; color: #9ca3af;">
                <strong>Assessment:</strong> {{ vocab.assessment | default('N/A') | title }}
                {% if vocab.assessment == 'excellent' %}
                â€” Excellent vocabulary diversity indicates original writing.
                {% elif vocab.assessment == 'good' %}
                â€” Good vocabulary range suggests authentic content.
                {% elif vocab.assessment == 'moderate' %}
                â€” Moderate diversity; consider varying word choice.
                {% else %}
                â€” Low vocabulary diversity may indicate copied or templated content.
                {% endif %}
              </p>
              {% endif %}
            </div>

            <!-- Common Phrases Panel -->
            <div class="analysis-panel" data-panel="phrases">
              {% if plagiarism_data.analyses and plagiarism_data.analyses.common_phrases %}
              {% set phrases = plagiarism_data.analyses.common_phrases %}
              <p style="font-size: 14px; color: #9ca3af; margin-bottom: 16px;">
                Boilerplate density: {{ phrases.boilerplate_density }}% ({{ phrases.risk_level | title }} Risk)
              </p>
              {% if phrases.common_phrases %}
              <div class="phrase-list">
                {% for phrase in phrases.common_phrases[:10] %}
                <div class="phrase-item">
                  <span class="phrase-text">"{{ phrase.phrase }}"</span>
                  <span class="phrase-count">{{ phrase.count }}x</span>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="empty-state" style="padding: 20px;">
                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>Low Boilerplate Usage</h4>
                <p>Document shows minimal use of common academic phrases.</p>
              </div>
              {% endif %}
              {% endif %}
            </div>

            <!-- Style Panel -->
            <div class="analysis-panel" data-panel="style">
              {% if plagiarism_data.analyses and plagiarism_data.analyses.style_consistency %}
              {% set style = plagiarism_data.analyses.style_consistency %}
              <p style="font-size: 14px; color: #9ca3af; margin-bottom: 16px;">
                Style Consistency Score: <strong style="color: #8af3ff;">{{ style.consistency_score }}%</strong>
                ({{ style.paragraph_count | default(0) }} paragraphs analyzed)
              </p>
              {% if style.variations %}
              <div class="issues-list">
                {% for variation in style.variations %}
                <div class="issue-item">
                  <div class="issue-icon {{ variation.severity }}">
                    <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path></svg>
                  </div>
                  <div class="issue-content">
                    <div class="issue-type">{{ variation.metric | replace('_', ' ') }}</div>
                    <div class="issue-message">{{ variation.description }}</div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="empty-state" style="padding: 20px;">
                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>Consistent Writing Style</h4>
                <p>Writing style appears consistent throughout the document.</p>
              </div>
              {% endif %}
              {% endif %}
            </div>

            <!-- Citations Panel -->
            <div class="analysis-panel" data-panel="citations">
              {% if plagiarism_data.analyses and plagiarism_data.analyses.citations %}
              {% set cites = plagiarism_data.analyses.citations %}
              <div class="citation-grid">
                <div class="citation-card">
                  <div class="citation-card-header">Total Citations</div>
                  <div class="citation-card-value highlight">{{ cites.total_citations | default(0) }}</div>
                </div>
                <div class="citation-card">
                  <div class="citation-card-header">Primary Style</div>
                  <div class="citation-card-value">{{ cites.primary_style | default('None') | upper }}</div>
                </div>
                <div class="citation-card">
                  <div class="citation-card-header">Citation Density</div>
                  <div class="citation-card-value">{{ cites.citation_density | default(0) }} per 100 words</div>
                </div>
              </div>
              {% if cites.mixed_styles %}
              <div class="issue-item" style="margin-bottom: 12px;">
                <div class="issue-icon low">
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                </div>
                <div class="issue-content">
                  <div class="issue-type">Mixed Styles</div>
                  <div class="issue-message">Multiple citation styles detected. Consider using a consistent format.</div>
                </div>
              </div>
              {% endif %}
              {% if cites.uncited_quotes %}
              <h5 style="font-size: 13px; color: #fbbf24; margin: 16px 0 12px;">Uncited Quoted Content</h5>
              {% for quote in cites.uncited_quotes %}
              <div class="duplicate-item" style="border-color: rgba(251, 191, 36, 0.3); background: rgba(251, 191, 36, 0.05);">
                <div class="duplicate-text">{{ quote.quote }}</div>
              </div>
              {% endfor %}
              {% endif %}
              {% endif %}
            </div>

            <!-- LLM Assessment -->
            {% if plagiarism_data.llm_enhanced and plagiarism_data.llm_assessment %}
            <div class="llm-assessment">
              <div class="llm-assessment-header">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>
                AI-Enhanced Assessment
              </div>
              <p class="llm-assessment-text">{{ plagiarism_data.llm_assessment }}</p>
              {% if plagiarism_data.llm_recommendations %}
              <ul class="llm-recommendations">
                {% for rec in plagiarism_data.llm_recommendations %}
                <li>{{ rec }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Citation Analysis Section -->
      {% if citation_data %}
      <div class="citation-section">
        <div class="citation-panel">
          <div class="citation-header">
            <div class="citation-title">
              <svg viewBox="0 0 24 24"><path d="M6 2h9a2 2 0 0 1 2 2v2"></path><path d="M6 22h12a2 2 0 0 0 2-2V9.5L14.5 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12 18v-6"></path><path d="M9 15l3 3 3-3"></path></svg>
              Citation Analysis
            </div>
            <div class="citation-score-container">
              <div class="citation-score-ring">
                <svg viewBox="0 0 36 36">
                  <circle class="citation-ring-bg" cx="18" cy="18" r="15"></circle>
                  <circle class="citation-ring-progress {{ citation_data.risk_level | default('good') }}" 
                          cx="18" cy="18" r="15"
                          stroke-dasharray="{{ ((citation_data.citation_score | default(75)) / 100) * 94.2 }} 94.2"></circle>
                </svg>
                <span class="citation-score-text {{ citation_data.risk_level | default('good') }}">{{ citation_data.citation_score | default(75) }}</span>
              </div>
              <div class="citation-status">
                <div class="citation-status-label">Citation Quality</div>
                <div class="citation-status-value" style="color: {% if citation_data.risk_level == 'excellent' %}#10b981{% elif citation_data.risk_level == 'good' %}#8af3ff{% elif citation_data.risk_level == 'needs_improvement' %}#fbbf24{% else %}#ef4444{% endif %};">
                  {{ citation_data.risk_level | default('good') | replace('_', ' ') | title }}
                </div>
              </div>
            </div>
          </div>

          <div class="citation-content">
            <!-- Stats Grid -->
            <div class="citation-stats-grid">
              <div class="citation-stat-card">
                <div class="citation-stat-icon gold">
                  <svg viewBox="0 0 24 24"><path d="M6 2h9a2 2 0 0 1 2 2v2"></path><path d="M6 22h12a2 2 0 0 0 2-2V9.5L14.5 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"></path></svg>
                </div>
                <div class="citation-stat-value">{{ citation_data.total_citations | default(0) }}</div>
                <div class="citation-stat-label">Citations Found</div>
              </div>
              <div class="citation-stat-card">
                <div class="citation-stat-icon cyan">
                  <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                </div>
                <div class="citation-stat-value">{{ citation_data.total_references | default(0) }}</div>
                <div class="citation-stat-label">References</div>
              </div>
              <div class="citation-stat-card">
                <div class="citation-stat-icon green">
                  <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                </div>
                <div class="citation-stat-value">{{ citation_data.verified_count | default(0) }}</div>
                <div class="citation-stat-label">Verified Refs</div>
              </div>
              <div class="citation-stat-card">
                <div class="citation-stat-icon red">
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                </div>
                <div class="citation-stat-value">{{ citation_data.issues | length | default(0) }}</div>
                <div class="citation-stat-label">Issues Found</div>
              </div>
            </div>

            <!-- Citation Tabs -->
            <div class="citation-tabs" id="citation-tabs">
              <button class="citation-tab active" data-citpanel="issues">Issues & Recommendations</button>
              <button class="citation-tab" data-citpanel="references">References ({{ citation_data.total_references | default(0) }})</button>
              <button class="citation-tab" data-citpanel="claims">Unsupported Claims</button>
              <button class="citation-tab" data-citpanel="density">Density Analysis</button>
            </div>

            <!-- Issues Panel -->
            <div class="citation-tab-panel active" data-citpanel="issues">
              {% if citation_data.issues %}
              {% for issue in citation_data.issues %}
              <div class="citation-issue-card {{ issue.severity | default('minor') }}">
                <div class="citation-issue-header">
                  <span class="citation-issue-type {{ issue.severity | default('minor') }}">{{ issue.severity | default('minor') }}</span>
                  <span class="citation-issue-title">{{ issue.title }}</span>
                </div>
                <div class="citation-issue-description">{{ issue.description }}</div>
                {% if issue.recommendation %}
                <div class="citation-issue-recommendation">{{ issue.recommendation }}</div>
                {% endif %}
              </div>
              {% endfor %}
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>No Major Issues</h4>
                <p>Citation practices appear to be well-maintained.</p>
              </div>
              {% endif %}

              <!-- LLM Citation Assessment -->
              {% if citation_data.llm_analysis %}
              <div class="llm-citation-assessment">
                <div class="llm-citation-header">
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>
                  AI Citation Assessment
                  {% if citation_data.llm_analysis.credibility %}
                  <span class="credibility-badge {{ citation_data.llm_analysis.credibility }}">{{ citation_data.llm_analysis.credibility }} Credibility</span>
                  {% endif %}
                </div>
                <p class="llm-assessment-text">{{ citation_data.llm_analysis.assessment | default('No assessment available.') }}</p>
                {% if citation_data.llm_analysis.recommendations %}
                <ul class="llm-recommendations">
                  {% for rec in citation_data.llm_analysis.recommendations %}
                  <li>{{ rec }}</li>
                  {% endfor %}
                </ul>
                {% endif %}
              </div>
              {% endif %}
            </div>

            <!-- References Panel -->
            <div class="citation-tab-panel" data-citpanel="references">
              {% if citation_data.references %}
              <div class="reference-list">
                {% for ref in citation_data.references %}
                <div class="reference-item">
                  <div class="reference-header">
                    <span class="reference-number">{{ ref.number }}</span>
                    {% if ref.verification %}
                    <span class="reference-verification {% if ref.verification.verified %}verified{% elif ref.verification.confidence > 0.5 %}partial{% else %}unverified{% endif %}">
                      {% if ref.verification.verified %}âœ“ Verified{% elif ref.verification.confidence > 0.5 %}Partial{% else %}âš  Unverified{% endif %}
                    </span>
                    {% endif %}
                    {% if ref.year %}
                    <span class="reference-meta-item">
                      <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                      {{ ref.year }}
                    </span>
                    {% endif %}
                  </div>
                  <div class="reference-text">{{ ref.raw_text[:200] }}{% if ref.raw_text | length > 200 %}...{% endif %}</div>
                  <div class="reference-meta">
                    {% if ref.doi %}
                    <span class="reference-meta-item">
                      <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                      DOI: {{ ref.doi[:30] }}...
                    </span>
                    {% endif %}
                    {% if ref.title %}
                    <span class="reference-meta-item" title="{{ ref.title }}">
                      <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                      {{ ref.title[:40] }}{% if ref.title | length > 40 %}...{% endif %}
                    </span>
                    {% endif %}
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                <h4>No References Found</h4>
                <p>Could not detect a references section in the document.</p>
              </div>
              {% endif %}
            </div>

            <!-- Unsupported Claims Panel -->
            <div class="citation-tab-panel" data-citpanel="claims">
              {% if citation_data.unsupported_claims %}
              <p style="font-size: 13px; color: #9ca3af; margin-bottom: 16px;">
                These statements typically require citations but appear to lack proper references:
              </p>
              {% for claim in citation_data.unsupported_claims %}
              <div class="claim-item">
                <div class="claim-type">{{ claim.type }}</div>
                <div class="claim-context">
                  {{ claim.context | replace(claim.text, '<mark>' ~ claim.text ~ '</mark>') | safe }}
                </div>
                <div class="claim-location">Page {{ claim.page }}</div>
              </div>
              {% endfor %}
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4>All Claims Appear Supported</h4>
                <p>No obvious unsupported claims detected.</p>
              </div>
              {% endif %}
            </div>

            <!-- Density Analysis Panel -->
            <div class="citation-tab-panel" data-citpanel="density">
              {% if citation_data.citation_density %}
              <div class="citation-stats-grid" style="margin-bottom: 20px;">
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.citation_density.citations_per_1000_words | default(0) }}</div>
                  <div class="citation-stat-label">Per 1000 Words</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.citation_density.citations_per_sentence | default(0) }}</div>
                  <div class="citation-stat-label">Per Sentence</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.styles_found | length | default(0) }}</div>
                  <div class="citation-stat-label">Styles Found</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{% if citation_data.styles_found %}{{ citation_data.styles_found[0] | replace('_', ' ') | title }}{% else %}None{% endif %}</div>
                  <div class="citation-stat-label">Primary Style</div>
                </div>
              </div>

              {% if citation_data.reference_quality %}
              <h5 style="font-size: 14px; color: #fbbf24; margin-bottom: 12px;">Reference Quality Metrics</h5>
              <div class="citation-stats-grid">
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.reference_quality.avg_year | default('N/A') }}</div>
                  <div class="citation-stat-label">Average Year</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.reference_quality.recent_refs_count | default(0) }}</div>
                  <div class="citation-stat-label">Recent (2020+)</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.reference_quality.outdated_refs_count | default(0) }}</div>
                  <div class="citation-stat-label">Outdated (&lt;2010)</div>
                </div>
                <div class="citation-stat-card">
                  <div class="citation-stat-value">{{ citation_data.reference_quality.newest_year | default('N/A') }}-{{ citation_data.reference_quality.oldest_year | default('N/A') }}</div>
                  <div class="citation-stat-label">Year Range</div>
                </div>
              </div>
              {% endif %}

              {% if citation_data.page_distribution %}
              <h5 style="font-size: 14px; color: #fbbf24; margin: 20px 0 12px;">Citation Distribution by Page</h5>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                {% for page, count in citation_data.page_distribution.items() %}
                <div style="padding: 10px 14px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 8px; text-align: center;">
                  <div style="font-size: 16px; font-weight: 700; color: #fbbf24;">{{ count }}</div>
                  <div style="font-size: 10px; color: #9ca3af;">Page {{ page }}</div>
                </div>
                {% endfor %}
              </div>
              {% endif %}
              {% else %}
              <div class="empty-state">
                <svg viewBox="0 0 24 24"><path d="M3 3v18h18"></path><path d="M18 17V9"></path><path d="M13 17V5"></path><path d="M8 17v-3"></path></svg>
                <h4>No Density Data</h4>
                <p>Unable to calculate citation density metrics.</p>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <div class="actions">
        <a href="/" class="btn btn-secondary">
          <svg viewBox="0 0 24 24" style="width: 18px; height: 18px;"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
          Upload Another
        </a>
        <button class="btn btn-primary" onclick="downloadText()">
          <svg viewBox="0 0 24 24" style="width: 18px; height: 18px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
          Download Text
        </button>
      </div>
    </div>
  </div>

  <script>
    // PDF.js initialization
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // Store extracted text for download
    const extractedText = {{ extracted_text | tojson }};
    const isPdf = {{ is_pdf | tojson if is_pdf is defined else 'false' }};
    const pdfBase64 = {{ pdf_base64 | tojson if pdf_base64 else 'null' }};

    // PDF Viewer State
    let pdfDoc = null;
    let currentPage = 1;
    let totalPages = 0;
    let scale = 1.5;
    let rendering = false;

    // DOM Elements
    const pdfCanvas = document.getElementById('pdf-canvas');
    const pdfContainer = document.getElementById('pdf-container');
    const pdfWrapper = document.getElementById('pdf-wrapper');
    const pdfLoading = document.getElementById('pdf-loading');
    const highlightOverlay = document.getElementById('highlight-overlay');
    const scanLine = document.getElementById('scan-line');
    const connectionLine = document.getElementById('connection-line');
    const connectionPath = document.getElementById('connection-path');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesSpan = document.getElementById('total-pages');

    // Initialize PDF if available
    if (isPdf && pdfBase64) {
      loadPdf();
    }

    async function loadPdf() {
      try {
        const pdfData = atob(pdfBase64);
        const pdfArray = new Uint8Array(pdfData.length);
        for (let i = 0; i < pdfData.length; i++) {
          pdfArray[i] = pdfData.charCodeAt(i);
        }

        pdfDoc = await pdfjsLib.getDocument({ data: pdfArray }).promise;
        totalPages = pdfDoc.numPages;
        totalPagesSpan.textContent = totalPages;

        // Render first page
        await renderPage(1);

        // Show PDF
        pdfLoading.style.display = 'none';
        pdfWrapper.style.display = 'block';

        // Enable/disable navigation
        updateNavButtons();
      } catch (error) {
        console.error('PDF loading error:', error);
        pdfLoading.innerHTML = '<span style="color: #ef4444;">Failed to load PDF</span>';
      }
    }

    async function renderPage(pageNum) {
      if (rendering) return;
      rendering = true;

      try {
        const page = await pdfDoc.getPage(pageNum);
        
        // Calculate scale to fit container
        const containerWidth = pdfContainer.clientWidth - 40;
        const containerHeight = pdfContainer.clientHeight - 40;
        
        const viewport = page.getViewport({ scale: 1 });
        const scaleX = containerWidth / viewport.width;
        const scaleY = containerHeight / viewport.height;
        scale = Math.min(scaleX, scaleY, 2);

        const scaledViewport = page.getViewport({ scale });
        
        pdfCanvas.width = scaledViewport.width;
        pdfCanvas.height = scaledViewport.height;

        const ctx = pdfCanvas.getContext('2d');
        await page.render({
          canvasContext: ctx,
          viewport: scaledViewport
        }).promise;

        currentPage = pageNum;
        currentPageSpan.textContent = pageNum;
        updateNavButtons();

        // Clear highlights when changing pages
        clearHighlights();
      } catch (error) {
        console.error('Page render error:', error);
      } finally {
        rendering = false;
      }
    }

    function updateNavButtons() {
      if (prevBtn) prevBtn.disabled = currentPage <= 1;
      if (nextBtn) nextBtn.disabled = currentPage >= totalPages;
    }

    // Navigation event listeners
    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          renderPage(currentPage - 1);
        }
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          renderPage(currentPage + 1);
        }
      });
    }

    // Text functions
    function copyText() {
      navigator.clipboard.writeText(extractedText).then(() => {
        showNotification('Text copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }

    function downloadText() {
      const filename = '{{ filename }}'.replace(/\.[^/.]+$/, '') + '_extracted.txt';
      const blob = new Blob([extractedText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        background: linear-gradient(135deg, rgba(138, 243, 255, 0.9), rgba(94, 210, 255, 0.9));
        color: #050505;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        z-index: 10000;
        box-shadow: 0 10px 40px rgba(138, 243, 255, 0.4);
        animation: fadeInUp 0.3s ease-out;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(-50%) translateY(10px)';
        notification.style.transition = 'all 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    // Page tab switching
    const pageTabs = document.querySelectorAll('.page-tab');
    const pageSuggestions = document.querySelectorAll('.page-suggestions');

    pageTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const pageNum = tab.dataset.page;
        
        // Update active tab
        pageTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding suggestions
        pageSuggestions.forEach(ps => {
          if (ps.dataset.page === pageNum) {
            ps.classList.add('active');
          } else {
            ps.classList.remove('active');
          }
        });

        // If PDF and page number, navigate to that page
        if (isPdf && pdfDoc && pageNum !== 'overall') {
          const targetPage = parseInt(pageNum);
          if (targetPage && targetPage !== currentPage) {
            renderPage(targetPage);
          }
        }
      });
    });

    // Suggestion card expand/collapse and highlight mapping
    const suggestionCards = document.querySelectorAll('.suggestion-card');

    suggestionCards.forEach(card => {
      card.addEventListener('click', (e) => {
        const wasExpanded = card.classList.contains('expanded');
        suggestionCards.forEach(c => c.classList.remove('expanded'));
        if (!wasExpanded) {
          card.classList.add('expanded');
        }
      });

      // Hover effects with PDF highlight mapping
      card.addEventListener('mouseenter', () => {
        if (isPdf && pdfDoc) {
          const pageNum = parseInt(card.dataset.page);
          
          // Navigate to the relevant page if needed
          if (pageNum && pageNum !== currentPage && pageNum > 0) {
            renderPage(pageNum).then(() => {
              showHighlightOnPdf(card);
            });
          } else if (pageNum > 0) {
            showHighlightOnPdf(card);
          }
        }
      });

      card.addEventListener('mouseleave', () => {
        clearHighlights();
        hideConnectionLine();
      });
    });

    function showHighlightOnPdf(card) {
      if (!highlightOverlay || !pdfCanvas) return;

      // Get location data from card (normalized 0-1 values)
      const locY = parseFloat(card.dataset.locationY) || 0.3;
      const locX = parseFloat(card.dataset.locationX) || 0.1;
      const locWidth = parseFloat(card.dataset.locationWidth) || 0.8;
      const locHeight = parseFloat(card.dataset.locationHeight) || 0.06;

      // Clear existing highlights
      highlightOverlay.innerHTML = '';

      // Create highlight box
      const highlightBox = document.createElement('div');
      highlightBox.className = 'highlight-box';
      
      // Position based on normalized coordinates (0-1 range)
      highlightBox.style.left = (locX * 100) + '%';
      highlightBox.style.top = (locY * 100) + '%';
      highlightBox.style.width = (locWidth * 100) + '%';
      highlightBox.style.height = Math.max(locHeight * 100, 3) + '%';

      highlightOverlay.appendChild(highlightBox);

      // Animate in
      requestAnimationFrame(() => {
        highlightBox.classList.add('active');
      });

      // Show scan line effect
      if (scanLine) {
        scanLine.style.top = '0';
        scanLine.classList.add('active');
        setTimeout(() => {
          scanLine.classList.remove('active');
        }, 1500);
      }

      // Draw connection line after a short delay to ensure highlight is rendered
      setTimeout(() => {
        drawConnectionLine(card, highlightBox);
      }, 50);
    }

    function drawConnectionLine(card, highlightBox) {
      if (!connectionLine || !connectionPath) return;

      // Get bounding rectangles
      const cardRect = card.getBoundingClientRect();
      const highlightRect = highlightBox.getBoundingClientRect();
      const pdfWrapperRect = pdfWrapper ? pdfWrapper.getBoundingClientRect() : null;

      // Check if elements are visible
      if (!highlightRect.width || !highlightRect.height) return;

      // Start point: left center of the suggestion card
      const startX = cardRect.left;
      const startY = cardRect.top + (cardRect.height / 2);

      // End point: right center of the highlight box
      const endX = highlightRect.right;
      const endY = highlightRect.top + (highlightRect.height / 2);

      // Calculate control points for smooth curve
      const deltaX = Math.abs(startX - endX);
      const controlOffset = Math.min(deltaX * 0.4, 150);

      // Create path from highlight to card (right to left)
      const pathD = `M ${endX} ${endY} C ${endX + controlOffset} ${endY}, ${startX - controlOffset} ${startY}, ${startX} ${startY}`;
      
      connectionPath.setAttribute('d', pathD);
      
      // Position SVG to cover the entire viewport
      connectionLine.style.position = 'fixed';
      connectionLine.style.width = '100vw';
      connectionLine.style.height = '100vh';
      connectionLine.style.left = '0';
      connectionLine.style.top = '0';
      connectionLine.style.pointerEvents = 'none';
      connectionLine.classList.add('active');
    }

    function clearHighlights() {
      if (highlightOverlay) {
        highlightOverlay.innerHTML = '';
      }
    }

    function hideConnectionLine() {
      if (connectionLine) {
        connectionLine.classList.remove('active');
      }
    }

    // Tooltip functionality
    const tooltip = document.getElementById('tooltip');
    const tooltipTitle = tooltip.querySelector('.tooltip-title');
    const tooltipDesc = tooltip.querySelector('.tooltip-desc');
    const tooltipFix = tooltip.querySelector('.tooltip-fix');
    let tooltipTimeout;

    suggestionCards.forEach(card => {
      card.addEventListener('mouseenter', (e) => {
        clearTimeout(tooltipTimeout);
        
        const title = card.dataset.title || '';
        const description = card.dataset.description || '';
        const fix = card.dataset.fix || '';
        
        if (title || description) {
          tooltipTitle.textContent = title;
          tooltipDesc.textContent = description.substring(0, 150) + (description.length > 150 ? '...' : '');
          tooltipFix.textContent = fix ? 'ðŸ’¡ ' + fix.substring(0, 100) + (fix.length > 100 ? '...' : '') : '';
          tooltipFix.style.display = fix ? 'block' : 'none';
          
          tooltipTimeout = setTimeout(() => {
            positionTooltip(e);
            tooltip.classList.add('visible');
          }, 400);
        }
      });

      card.addEventListener('mousemove', (e) => {
        if (tooltip.classList.contains('visible')) {
          positionTooltip(e);
        }
      });

      card.addEventListener('mouseleave', () => {
        clearTimeout(tooltipTimeout);
        tooltip.classList.remove('visible');
      });
    });

    function positionTooltip(e) {
      const x = e.clientX + 15;
      const y = e.clientY + 15;
      
      const tooltipRect = tooltip.getBoundingClientRect();
      const maxX = window.innerWidth - tooltipRect.width - 20;
      const maxY = window.innerHeight - tooltipRect.height - 20;
      
      tooltip.style.left = Math.min(x, maxX) + 'px';
      tooltip.style.top = Math.min(y, maxY) + 'px';
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        suggestionCards.forEach(c => c.classList.remove('expanded'));
        tooltip.classList.remove('visible');
        clearHighlights();
        hideConnectionLine();
      }
      
      // Arrow keys for PDF navigation
      if (isPdf && pdfDoc) {
        if (e.key === 'ArrowLeft' && currentPage > 1) {
          renderPage(currentPage - 1);
        } else if (e.key === 'ArrowRight' && currentPage < totalPages) {
          renderPage(currentPage + 1);
        }
      }
    });

    // Resize handler
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (isPdf && pdfDoc && currentPage) {
          renderPage(currentPage);
        }
      }, 200);
    });

    // Plagiarism Analysis Tab Switching
    const plagiarismTabs = document.querySelectorAll('#plagiarism-tabs .analysis-tab');
    const analysisPanels = document.querySelectorAll('.analysis-panel');

    plagiarismTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const panelName = tab.dataset.panel;
        
        // Update active tab
        plagiarismTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding panel
        analysisPanels.forEach(panel => {
          if (panel.dataset.panel === panelName) {
            panel.classList.add('active');
          } else {
            panel.classList.remove('active');
          }
        });
      });
    });

    // Animate score circle on load
    const scoreCircle = document.querySelector('.score-circle-progress');
    if (scoreCircle) {
      const finalOffset = scoreCircle.getAttribute('stroke-dashoffset');
      scoreCircle.style.strokeDashoffset = '97.4';
      
      setTimeout(() => {
        scoreCircle.style.transition = 'stroke-dashoffset 1.5s ease-out';
        scoreCircle.style.strokeDashoffset = finalOffset;
      }, 500);
    }

    // Citation Analysis Tab Switching
    const citationTabs = document.querySelectorAll('#citation-tabs .citation-tab');
    const citationPanels = document.querySelectorAll('.citation-tab-panel');

    citationTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const panelName = tab.dataset.citpanel;
        
        // Update active tab
        citationTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding panel
        citationPanels.forEach(panel => {
          if (panel.dataset.citpanel === panelName) {
            panel.classList.add('active');
          } else {
            panel.classList.remove('active');
          }
        });
      });
    });

    // Animate citation score ring on load
    const citationScoreRing = document.querySelector('.citation-ring-progress');
    if (citationScoreRing) {
      const dashArray = citationScoreRing.getAttribute('stroke-dasharray');
      citationScoreRing.style.strokeDasharray = '0 94.2';
      
      setTimeout(() => {
        citationScoreRing.style.transition = 'stroke-dasharray 1.5s ease-out';
        citationScoreRing.style.strokeDasharray = dashArray;
      }, 700);
    }
  </script>
</body>
</html>
